<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>Qu·∫£n l√Ω voucher</title>
  <link href="https://cdn.tailwindcss.com" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    form {
      margin-top: 20px;
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .edit-btn {
      background-color: #2980b9;
      color: white;
    }

    .delete-btn {
      background-color: #e74c3c;
      color: white;
    }
  </style>
</head>

<body>
  <div th:replace="~{dashboard :: nav}"></div>

  <h2>üéüÔ∏è Th√™m voucher</h2>
  <form th:action="@{/vouchers/save}" method="post" th:object="${voucher}" class="space-y-4">
    <input type="hidden" th:field="*{id}">

    <div>
      <label class="block text-gray-700">M√£ Code</label>
      <input type="text" th:field="*{code}" class="w-full border rounded p-2" required>
    </div>

    <div>
      <label class="block text-gray-700">Gi·∫£m (%)</label>
      <input type="number" min="0" max="100" step="1" th:field="*{discountPercent}" class="w-full border rounded p-2"
        required>
    </div>

    <div>
      <label class="block text-gray-700">Gi√° t·ªëi thi·ªÉu (VNƒê)</label>
      <!-- Hi·ªÉn th·ªã gi√° ƒë·ªãnh d·∫°ng -->
      <input type="text" id="minPriceDisplay"
        th:value="${voucher.minimumPrice != null ? #numbers.formatDecimal(voucher.minimumPrice, 0, 'COMMA', 0, 'POINT') : ''}"
        class="w-full border rounded p-2" required>

      <!-- Hidden field ƒë·ªÉ binding d·ªØ li·ªáu v·ªÅ controller -->
      <input type="hidden" id="minPriceHidden" th:field="*{minimumPrice}" />
    </div>


    <div>
      <label class="block text-gray-700">S·ªë l∆∞·ª£ng</label>
      <input type="number" min="1" th:field="*{quantity}" class="w-full border rounded p-2" required>
    </div>

    <div>
      <label class="block text-gray-700">Ng√†y b·∫Øt ƒë·∫ßu</label>
      <input type="date" th:field="*{startDate}" class="w-full border rounded p-2" required>
    </div>

    <div>
      <label class="block text-gray-700">Ng√†y k·∫øt th√∫c</label>
      <input type="date" th:field="*{endDate}" class="w-full border rounded p-2" required>
    </div>

    <div class="flex justify-end">
      <button type="submit" class="bg-blue-600 hover:bg-blue-800 text-white px-4 py-2 rounded">
        L∆∞u Voucher
      </button>
    </div>
  </form>
  <div th:if="${error}" class="text-red-500 font-semibold mb-2">
    <p th:text="${error}"></p>
  </div>

  </div>

  <div class="max-w-3xl mx-auto mt-10 bg-white p-6 shadow-md rounded-lg">
    <h2 class="text-xl font-semibold mb-4">Danh s√°ch Voucher</h2>
    <table class="w-full table-auto border">
      <thead class="bg-gray-200">
        <tr>
          <th class="px-4 py-2 border">M√£</th>
          <th class="px-4 py-2 border">Gi·∫£m (%)</th>
          <th class="px-4 py-2 border">Gi√° t·ªëi thi·ªÉu</th>
          <th class="px-4 py-2 border">S·ªë l∆∞·ª£ng</th>
          <th class="px-4 py-2 border">B·∫Øt ƒë·∫ßu</th>
          <th class="px-4 py-2 border">K·∫øt th√∫c</th>
          <th class="px-4 py-2 border">H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="v : ${vouchers}">
          <td class="border px-4 py-2" th:text="${v.code}"></td>
          <td class="border px-4 py-2" th:text="${v.discountPercent} + '%'"></td>
          <td class="border px-4 py-2" th:text="${v.minimumPrice}"></td>
          <td class="border px-4 py-2" th:text="${v.quantity}"></td>
          <td class="border px-4 py-2" th:text="${v.startDate}"></td>
          <td class="border px-4 py-2" th:text="${v.endDate}"></td>
          <td class="border px-4 py-2 space-x-2">
            <a th:href="@{/vouchers/edit/{id}(id=${v.id})}" class="text-blue-600 hover:underline">S·ª≠a</a>
            <a th:href="@{/vouchers/delete/{id}(id=${v.id})}" class="text-red-600 hover:underline"
              onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?')">X√≥a</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</body>

</html>
<script>
  // Format v·ªÅ s·ªë (remove d·∫•u ph·∫©y) khi nh·∫≠p gi√°
  document.getElementById('minPriceDisplay').addEventListener('input', function () {
    const raw = this.value.replace(/,/g, '').replace(/\D/g, '');
    const formatted = Number(raw).toLocaleString('en-US');
    this.value = formatted;

    document.getElementById('minPriceHidden').value = raw;
  });
</script>