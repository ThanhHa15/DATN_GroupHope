<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>Thêm Thông số kỹ thuật</title>
  <style>
    /* ===== BẢNG THÔNG SỐ ===== */
    table.spec-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 15px;
    }

    table.spec-table thead {
      background: #f5f5f5;
    }

    table.spec-table th,
    table.spec-table td {
      border: 1px solid #e0e0e0;
      padding: 8px 10px;
      text-align: left;
    }

    /* ID, Product, Key nhỏ – Value rộng */
    table.spec-table th:nth-child(1),
    table.spec-table td:nth-child(1) {
      width: 6%;
    }

    table.spec-table th:nth-child(2),
    table.spec-table td:nth-child(2) {
      width: 10%;
    }

    table.spec-table th:nth-child(3),
    table.spec-table td:nth-child(3) {
      width: 18%;
    }

    /* Cột giá trị chiếm ~40‑45% */
    table.spec-table th:nth-child(4),
    table.spec-table td:nth-child(4) {
      width: 45%;
    }

    /* Cột thao tác còn lại */
    table.spec-table th:nth-child(5),
    table.spec-table td:nth-child(5) {
      width: 10%;
      text-align: center;
    }

    /* ===== Ô INPUT chỉnh sửa ===== */
    .spec-edit-form {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .spec-edit-form input[type="text"] {
      flex: 1;
      /* tự giãn đầy cột */
      min-width: 180px;
      padding: 6px 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .spec-edit-form button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }

    .spec-edit-form button:hover {
      background: #155a9e;
    }

    /* Link xoá */
    a.delete-link {
      color: #d32f2f;
      text-decoration: none;
    }

    a.delete-link:hover {
      text-decoration: underline;
    }
  </style>
  <style>
    .spec-row {
      display: none;
    }

    .product-header {
      cursor: pointer;
      background-color: #f9f9f9;
      font-weight: bold;
    }

    .spec-table {
      width: 100%;
      border-collapse: collapse;
    }

    .spec-table th,
    .spec-table td {
      border: 1px solid #ddd;
      padding: 8px;
    }
  </style>
</head>

<body>
  <div th:replace="~{dashboard :: nav}"></div>
  <h2>Thêm thông số kỹ thuật</h2>

  <form th:action="@{/specification/save}" method="post" enctype="multipart/form-data" accept-charset="UTF-8">
    <!-- Select Product -->
    <label>Chọn sản phẩm:</label>
    <select id="productSelect" name="productid" onchange="showFieldsByProductType()" required>
      <option value="" disabled selected>-- Chọn sản phẩm --</option>
      <option th:each="p : ${products}" th:value="${p.productID}" th:data-type="${p.category.name.toLowerCase()}"
        th:text="${p.productName}"></option>
    </select>

    <br /><br />

    <!-- Iphone Form -->
    <div id="form-type-iphone" class="spec-form" style="display: none">
      <h3>Thông số iPhone</h3>
      <div>
        <label>Kích thước màn hình:</label>
        <input type="text" name="specs['Kích thước màn hình']" />
      </div>
      <div>
        <label>Công nghệ màn hình:</label>
        <input type="text" name="specs['Công nghệ màn hình']" />
      </div>
      <div>
        <label>Camera sau:</label>
        <input type="text" name="specs['Camera sau']" />
      </div>
      <div>
        <label>Camera trước:</label>
        <input type="text" name="specs['Camera trước']" />
      </div>
      <div>
        <label>Chipset:</label>
        <input type="text" name="specs['Chipset']" />
      </div>
      <div>
        <label>Công nghệ NFC:</label>
        <input type="text" name="specs['Công nghệ NFC']" />
      </div>
      <div>
        <label>Dung lượng RAM:</label>
        <input type="text" name="specs['Dung lượng RAM']" />
      </div>
      <div>
        <label>Pin:</label>
        <input type="text" name="specs['Pin']" />
      </div>
      <div>
        <label>Thẻ SIM:</label>
        <input type="text" name="specs['Thẻ SIM']" />
      </div>
      <div>
        <label>Hệ điều hành:</label>
        <input type="text" name="specs['Hệ điều hành']" />
      </div>
      <div>
        <label>Độ phân giải màn hình:</label>
        <input type="text" name="specs['Độ phân giải màn hình']" />
      </div>
      <div>
        <label>Tính năng màn hình:</label>
        <textarea name="specs['Tính năng màn hình']" rows="5"></textarea>
      </div>
      <div>
        <label>Loại CPU:</label>
        <input type="text" name="specs['Loại CPU']" />
      </div>
    </div>

    <!-- Ipad Form -->
    <div id="form-type-ipad" class="spec-form" style="display: none">
      <h3>Thông số iPad</h3>

      <div>
        <label>Kích thước màn hình:</label>
        <input type="text" name="specs['Kích thước màn hình']" />
      </div>
      <div>
        <label>Công nghệ màn hình:</label>
        <input type="text" name="specs['Công nghệ màn hình']" />
      </div>
      <div>
        <label>Camera sau:</label>
        <input type="text" name="specs['Camera sau']" />
      </div>
      <div>
        <label>Camera trước:</label>
        <input type="text" name="specs['Camera trước']" />
      </div>
      <div>
        <label>Chipset:</label>
        <input type="text" name="specs['Chipset']" />
      </div>
      <div>
        <label>Công nghệ NFC:</label>
        <input type="text" name="specs['Công nghệ NFC']" />
      </div>
      <div>
        <label>Dung lượng RAM:</label>
        <input type="text" name="specs['Dung lượng RAM']" />
      </div>

      <div>
        <label>Pin:</label>
        <input type="text" name="specs['Pin']" />
      </div>
      <div>
        <label>Thẻ SIM:</label>
        <input type="text" name="specs['Thẻ SIM']" />
      </div>
      <div>
        <label>Hệ điều hành:</label>
        <input type="text" name="specs['Hệ điều hành']" />
      </div>
      <div>
        <label>Độ phân giải màn hình:</label>
        <input type="text" name="specs['Độ phân giải màn hình']" />
      </div>
      <div>
        <label>Tính năng màn hình:</label>
        <textarea name="specs['Tính năng màn hình']" rows="5"></textarea>
      </div>
      <div>
        <label>Loại CPU:</label>
        <input type="text" name="specs['Loại CPU']" />
      </div>
      <div>
        <label>Tương thích:</label>
        <textarea name="specs['Tương thích']" rows="4"></textarea>
      </div>
    </div>

    <!-- Macbook Form -->
    <div id="form-type-macbook" class="spec-form" style="display: none">
      <h3>Thông số MacBook</h3>

      <div>
        <label>Loại card đồ họa:</label>
        <textarea name="specs['Loại card đồ họa']" rows="4"></textarea>
      </div>

      <div>
        <label>Dung lượng RAM:</label>
        <input type="text" name="specs['Dung lượng RAM']" />
      </div>
      <div>
        <label>Kích thước màn hình:</label>
        <input type="text" name="specs['Kích thước màn hình']" />
      </div>

      <div>
        <label>Công nghệ màn hình:</label>
        <textarea name="specs['Công nghệ màn hình']" rows="4"></textarea>
      </div>

      <div>
        <label>Pin:</label>
        <textarea name="specs['Pin']" rows="3"></textarea>
      </div>

      <div>
        <label>Hệ điều hành:</label>
        <input type="text" name="specs['Hệ điều hành']" />
      </div>

      <div>
        <label>Độ phân giải màn hình:</label>
        <input type="text" name="specs['Độ phân giải màn hình']" />
      </div>

      <div>
        <label>Loại CPU:</label>
        <input type="text" name="specs['Loại CPU']" />
      </div>

      <div>
        <label>Cổng giao tiếp:</label>
        <textarea name="specs['Cổng giao tiếp']" rows="4"></textarea>
      </div>
    </div>

    <!-- Apple Watch Form -->
    <div id="form-type-applewatch" class="spec-form" style="display: none">
      <h3>Thông số Apple Watch</h3>
      <div>
        <label>Công nghệ màn hình:</label><input type="text" name="specs['Công nghệ màn hình']" />
      </div>
      <div>
        <label>Đường kính mặt:</label><input type="text" name="specs['Đường kính mặt']" />
      </div>
      <div>
        <label>Kích thước cổ tay phù hợp:</label><input type="text" name="specs['Kích thước cổ tay phù hợp']" />
      </div>
      <div>
        <label>Nghe, gọi:</label><input type="text" name="specs['Nghe, gọi']" />
      </div>
      <div>
        <label>Tiện ích sức khoẻ:</label><input type="text" name="specs['Tiện ích sức khoẻ']" />
      </div>
      <div>
        <label>Tương thích:</label><input type="text" name="specs['Tương thích']" />
      </div>
      <div>
        <label>Thời lượng pin:</label><input type="text" name="specs['Thời lượng pin']" />
      </div>
      <div>
        <label>Hãng sản xuất:</label><input type="text" name="specs['Hãng sản xuất']" />
      </div>
    </div>

    <!-- AirPods Form -->
    <div id="form-type-airpods" class="spec-form" style="display: none">
      <h3>Thông số AirPods</h3>

      <div>
        <label>Kích thước:</label>
        <input type="text" name="specs['Kích thước']" />
      </div>

      <div>
        <label>Trọng lượng:</label>
        <input type="text" name="specs['Trọng lượng']" />
      </div>

      <div>
        <label>Công nghệ âm thanh:</label>
        <input type="text" name="specs['Công nghệ âm thanh']" />
      </div>

      <div>
        <label>Micro:</label>
        <input type="text" name="specs['Micro']" />
      </div>

      <div>
        <label>Thời lượng sử dụng:</label>
        <input type="text" name="specs['Thời lượng sử dụng']" />
      </div>

      <div>
        <label>Pin:</label>
        <input type="text" name="specs['Pin']" />
      </div>

      <div>
        <label>Phương thức điều khiển:</label>
        <input type="text" name="specs['Phương thức điều khiển']" />
      </div>

      <div>
        <label>Chipset:</label>
        <input type="text" name="specs['Chipset']" />
      </div>
    </div>


    <br />
    <button type="submit">Lưu thông số</button>
  </form>
  <hr />

  <h3>Danh sách thông số đã lưu</h3>
  <table class="spec-table">
    <thead>
      <tr>
        <th>Sản phẩm</th>
        <th>Tên thông số</th>
        <th>Giá trị</th>
      </tr>
    </thead>
    <tbody th:each="entry : ${groupedSpecList}">
      <!-- Dòng tiêu đề sản phẩm -->
      <tr class="product-header" th:onclick="|toggleSpecs('group-' + ${entry.key})|">
        <td th:text="${productIdToNameMap.get(entry.key)}" colspan="3"></td>
      </tr>

      <!-- Các dòng thông số -->
      <tr th:each="spec : ${entry.value}" th:id="|group-${spec.productid}|" class="spec-row">
        <td></td>
        <td th:text="${spec.specKey}"></td>
        <td>
          <form th:action="@{/specification/update}" method="post" class="spec-edit-form">
            <input type="hidden" name="specId" th:value="${spec.specId}" />
            <input type="text" name="specValue" th:value="${spec.specValue}" />
            <button type="submit">Cập nhật</button>
          </form>
        </td>
      </tr>
    </tbody>
  </table>

  <script>
    function showFieldsByProductType() {
      const select = document.getElementById("productSelect");
      const selectedOption = select.options[select.selectedIndex];
      const type = selectedOption.getAttribute("data-type");

      const allForms = document.querySelectorAll(".spec-form");

      allForms.forEach((form) => {
        form.style.display = "none";

        // disable & remove required
        const inputs = form.querySelectorAll("input, textarea");
        inputs.forEach((el) => {
          el.disabled = true;
          el.removeAttribute("required");
        });
      });

      if (type) {
        const formToShow = document.getElementById("form-type-" + type);
        if (formToShow) {
          formToShow.style.display = "block";

          // enable & add required
          const inputs = formToShow.querySelectorAll("input, textarea");
          inputs.forEach((el) => {
            el.disabled = false;
            el.setAttribute("required", "required");
          });
        }
      }
    }

    document.addEventListener("DOMContentLoaded", showFieldsByProductType);
  </script>

  <script>
    function toggleSpecs(groupIdPrefix) {
      const rows = document.querySelectorAll(`tr[id^="${groupIdPrefix}"]`);
      rows.forEach(row => {
        row.style.display = row.style.display === 'table-row' ? 'none' : 'table-row';
      });
    }
  </script>

</body>

</html>