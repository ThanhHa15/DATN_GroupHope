<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      background-color: #f0f3f7;
      margin: 0;
      font-family: "Poppins", sans-serif;
      color: #2c3e50;
    }

    /* Nội dung chính bên phải sidebar */
    .main-content {
      margin-left: 280px;
      /* đúng chiều rộng sidebar */
      padding: 20px;
    }

    .step h1 {
      font-size: 23px;
      margin-bottom: 18px;
    }

    .container2 {
      width: 100%;
      max-width: 1200px;
      margin-bottom: 40px;
      display: flex;
      flex-direction: row;
      background: linear-gradient(to bottom right, #ffffff, #f7f9fb);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    }

    form {
      flex: 1;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    input,
    select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      gap: 10px;
    }

    .next-btn,
    .prev-btn,
    .submit-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
    }

    .next-btn {
      background: #3498db;
    }

    .prev-btn {
      background: #95a5a6;
    }

    .submit-btn {
      background: #2ecc71;
    }

    .form-row {
      display: flex;
      gap: 20px;
      /* khoảng cách giữa 2 cột */
      margin-bottom: 15px;
    }

    .form-row .form-group {
      flex: 1;
      /* để 2 group chia đều chiều ngang */
    }

    textarea {
      width: 100%;
      /* chiếm hết chiều ngang */
      min-height: 80px;
      /* cao tối thiểu 80px */
    }
  </style>
</head>

<body>
  <div th:replace="nav :: na"></div>
  <div th:replace="header :: header"></div>
  <h1>demo</h1>
  <main class="main-content">
    <h1>Demo</h1>

    <!-- Thông báo thành công -->
    <div th:if="${param.success}"
      class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
      <strong class="font-bold">Thành công!</strong>
      <span class="block sm:inline">Thêm sản phẩm thành công.</span>
    </div>

    <!-- Thông báo thất bại -->
    <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"
      role="alert">
      <strong class="font-bold">Lỗi!</strong>
      <span class="block sm:inline" th:text="${error}"></span>
    </div>

    <form th:action="@{/admin-addPVP/saveAll}" method="post" enctype="multipart/form-data">
      <div id="step1" class="step" th:object="${product}">
        <h1>Thêm / Sửa sản phẩm</h1>
        <div class="card">
          <input type="hidden" th:field="*{productID}" required />

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Tên sản phẩm -->
            <div>
              <label class="block text-gray-700 text-base font-semibold mb-2">Tên sản phẩm</label>
              <input type="text" th:field="*{productName}" required placeholder="Nhập tên sản phẩm"
                id="productNameInput"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <!-- Loại -->
            <div>
              <label class="block text-gray-700 text-base font-semibold mb-2">Loại</label>
              <select th:field="*{category.categoryID}" id="categorySelect" required
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="" selected>Chọn loại</option>
                <option th:each="c : ${categories}" th:value="${c.categoryID}" th:text="${c.name}"></option>
              </select>
            </div>

            <!-- Trạng thái -->
            <div>
              <label class="block text-gray-700 text-base font-semibold mb-2">Trạng thái</label>
              <select th:field="*{status}" required
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="true">Đang kinh doanh</option>
                <option value="false">Ngừng kinh doanh</option>
              </select>
            </div>

            <!-- Ngày sx -->
            <div>
              <label class="block text-gray-700 text-base font-semibold mb-2">Ngày sản xuất:</label>
              <input type="date" th:field="*{manufactureDate}" required
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                th:max=" ${#temporals.format(#temporals.createToday(), 'yyyy-MM-dd' )}" />
              <span class="error-message" th:if="${#fields.hasErrors('manufactureDate')}"
                th:errors="*{manufactureDate}"></span>
            </div>
          </div>

          <!-- Mô tả -->
          <div>
            <label class="block text-gray-700 text-base font-semibold mb-2">Mô tả</label>
            <textarea th:field="*{description}" rows="3" placeholder="Nhập mô tả sản phẩm"
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
          </div>

          <!-- Ảnh -->
          <div style="display: none">
            <label class="block text-gray-700 text-base font-semibold mb-2">Ảnh</label>
            <input type="file" name="productImageFile" id="productImageFile" accept="image/*"
              class="block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />

            <!-- Ảnh preview -->
            <div class="mt-3">
              <img id="previewImage" src="" alt="Xem trước ảnh" class="max-h-48 rounded-lg shadow hidden" />
            </div>
          </div>
          <div class="form-actions">
            <button type="button" onclick="nextStep(1)" class="next-btn">
              Tiếp theo
            </button>
          </div>
        </div>
      </div>
      <div id="step2" class="step" style="display: none" th:object="${variant}">
        <h1>Thêm / Cập nhật phiên bản sản phẩm</h1>
        <div class="card">
          <input type="hidden" th:field="*{variantID}" />

          <div class="grid grid-cols-2 gap-6">
            <!-- Hàng 1 -->
            <div class="form-group">
              <label for="product" class="block text-gray-700 text-base font-semibold mb-2">Sản phẩm:</label>
              <input type="text" id="productNameDisplayStep2" readonly
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-100 focus:outline-none" />
              <input type="hidden" th:field="*{product.productID}" id="productIdHidden" />
            </div>

            <div class="form-group">
              <label class="block text-gray-700 text-base font-semibold mb-2">Số lượng:</label>
              <input type="number" th:field="*{quantityInStock}" required min="0" placeholder="Số lượng"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <!-- Hàng 2 -->
            <div class="form-group">
              <label class="block text-gray-700 text-base font-semibold mb-2">Dung lượng:</label>
              <select th:field="*{storage}"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="" selected>Chọn dung lượng</option>
                <option value="128GB">128GB</option>
                <option value="256GB">256GB</option>
                <option value="512GB">512GB</option>
                <option value="1TB">1TB</option>
                <option value="2TB">2TB</option>
              </select>
            </div>

            <div class="form-group">
              <label class="block text-gray-700 text-base font-semibold mb-2">Giá gốc (VNĐ):</label>
              <input type="text" id="priceInput" name="priceInput" placeholder="Giá gốc"
                th:value="${variant.price != null ? #numbers.formatDecimal(variant.price, 0, 'COMMA', 0, 'POINT') : ''}"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500" />
              <input type="hidden" th:field="*{price}" />
            </div>

            <!-- Hàng 3 -->
            <div class="form-group">
              <label class="block text-gray-700 text-base font-semibold mb-2">Màu:</label>
              <div class="flex gap-3 flex-wrap">
                <!-- Các option màu -->
                <label class="relative">
                  <input type="radio" name="color" value="Đen" th:field="*{color}" class="sr-only peer" />
                  <span
                    class="w-8 h-8 inline-block rounded-full border border-gray-300 cursor-pointer bg-black peer-checked:ring-2 peer-checked:ring-black peer-checked:ring-offset-2 transition"></span>
                </label>

                <label class="relative">
                  <input type="radio" name="color" value="Đỏ" th:field="*{color}" class="sr-only peer" />
                  <span
                    class="w-8 h-8 inline-block rounded-full border border-gray-300 cursor-pointer bg-red-600 peer-checked:ring-2 peer-checked:ring-red-600 peer-checked:ring-offset-2 transition"></span>
                </label>

                <label class="relative">
                  <input type="radio" name="color" value="Xanh lá" th:field="*{color}" class="sr-only peer" />
                  <span
                    class="w-8 h-8 inline-block rounded-full border border-gray-300 cursor-pointer bg-green-500 peer-checked:ring-2 peer-checked:ring-green-500 peer-checked:ring-offset-2 transition"></span>
                </label>

                <label class="relative">
                  <input type="radio" name="color" value="Xanh dương" th:field="*{color}" class="sr-only peer" />
                  <span
                    class="w-8 h-8 inline-block rounded-full border border-gray-300 cursor-pointer bg-blue-600 peer-checked:ring-2 peer-checked:ring-blue-600 peer-checked:ring-offset-2 transition"></span>
                </label>

                <!-- Màu Titan -->
                <label class="relative">
                  <input type="radio" name="color" value="Titan" th:field="*{color}" class="sr-only peer" />
                  <span
                    class="w-8 h-8 inline-block rounded-full border border-gray-300 cursor-pointer bg-gray-300 peer-checked:ring-2 peer-checked:ring-gray-500 peer-checked:ring-offset-2 transition"></span>
                </label>

                <!-- Màu Trắng -->
                <label class="relative">
                  <input type="radio" name="color" value="Trắng" th:field="*{color}" class="sr-only peer" />
                  <span
                    class="w-8 h-8 inline-block rounded-full border border-gray-300 cursor-pointer bg-white peer-checked:ring-2 peer-checked:ring-gray-400 peer-checked:ring-offset-2 transition"></span>
                </label>

                <!-- Màu Vàng -->
                <label class="relative">
                  <input type="radio" name="color" value="Vàng" th:field="*{color}" class="sr-only peer" />
                  <span
                    class="w-8 h-8 inline-block rounded-full border border-gray-300 cursor-pointer bg-yellow-400 peer-checked:ring-2 peer-checked:ring-yellow-400 peer-checked:ring-offset-2 transition"></span>
                </label>
                <!-- Màu Hồng -->
                <label class="relative">
                  <input type="radio" name="color" value="Hồng" th:field="*{color}" class="sr-only peer" />
                  <span
                    class="w-8 h-8 inline-block rounded-full border border-gray-300 cursor-pointer bg-pink-400 peer-checked:ring-2 peer-checked:ring-pink-400 peer-checked:ring-offset-2 transition"></span>
                </label>
              </div>
            </div>

            <div class="form-group">
              <label class="block text-gray-700 text-base font-semibold mb-2">Hình ảnh:</label>
              <input type="file" name="variantImageFile" id="variantImageFile" accept="image/*"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500" />

              <div class="image-preview mt-2">
                <!-- Nếu đang edit và đã có ảnh cũ -->
                <span th:if="${variant.imagesno2 != null}">
                  <img id="variantPreviewImage" th:src="@{'/images/' + ${variant.imagesno2}}"
                    class="product-image max-h-48 rounded shadow" />
                </span>
                <!-- Nếu chưa có ảnh cũ -->
                <img id="variantPreviewImageEmpty" src="" alt="Xem trước ảnh"
                  class="product-image max-h-48 rounded shadow hidden" />
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" onclick="prevStep(2)" class="prev-btn">
              Quay lại
            </button>
            <button type="button" onclick="nextStep(2)" class="next-btn">
              Tiếp theo
            </button>
          </div>
        </div>
      </div>
      <div id="step3" class="step" style="display: none">
        <h1>Quản lý thông số kỹ thuật</h1>

        <input type="hidden" id="productId" name="productid" value="${product.productID}" />
        <!-- Select Product -->
        <div class="form-group">
          <label for="productNameDisplayStep3" class="form-label">Sản phẩm:</label>
          <input type="text" id="productNameDisplayStep3" readonly class="form-control readonly-input" />
        </div>

        <!-- Iphone Form -->
        <div id="form-type-iphone" class="spec-form card" style="display: none">
          <div class="card-header">
            <h3 style="font-size: 20px; font-weight: 600">Thông số iPhone</h3>
          </div>
          <div class="card-body grid-container">
            <div class="form-row">
              <div class="form-group">
                <label>Kích thước màn hình:</label>
                <textarea class="form-control" name="specs[Kích thước màn hình]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Công nghệ màn hình:</label>
                <textarea class="form-control" name="specs[Công nghệ màn hình]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Camera sau:</label>
                <textarea class="form-control" name="specs[Camera sau]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Camera trước:</label>
                <textarea class="form-control" name="specs[Camera trước]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Chipset:</label>
                <textarea class="form-control" name="specs[Chipset]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Công nghệ NFC:</label>
                <textarea class="form-control" name="specs[Công nghệ NFC]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Dung lượng RAM:</label>
                <textarea class="form-control" name="specs[Dung lượng RAM]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Pin:</label>
                <textarea class="form-control" name="specs[Pin]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Thẻ SIM:</label>
                <textarea class="form-control" name="specs[Thẻ SIM]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Hệ điều hành:</label>
                <textarea class="form-control" name="specs[Hệ điều hành]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Độ phân giải màn hình:</label>
                <textarea class="form-control" name="specs[Độ phân giải màn hình]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Loại CPU:</label>
                <textarea class="form-control" name="specs[Loại CPU]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group" style="flex: 1">
                <label>Tính năng màn hình:</label>
                <textarea class="form-control" name="specs[Tính năng màn hình]" rows="2" required></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Ipad Form -->
        <div id="form-type-ipad" class="spec-form card" style="display: none">
          <div class="card-header">
            <h3 style="font-size: 20px; font-weight: 600">Thông số iPad</h3>
          </div>
          <div class="card-body grid-container">
            <div class="form-row">
              <div class="form-group">
                <label>Kích thước màn hình:</label>
                <textarea class="form-control" name="specs[Kích thước màn hình]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Công nghệ màn hình:</label>
                <textarea class="form-control" name="specs[Công nghệ màn hình]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Camera sau:</label>
                <textarea class="form-control" name="specs[Camera sau]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Camera trước:</label>
                <textarea class="form-control" name="specs[Camera trước]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Chipset:</label>
                <textarea class="form-control" name="specs[Chipset]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Công nghệ NFC:</label>
                <textarea class="form-control" name="specs[Công nghệ NFC]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Dung lượng RAM:</label>
                <textarea class="form-control" name="specs[Dung lượng RAM]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Pin:</label>
                <textarea class="form-control" name="specs[Pin]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Thẻ SIM:</label>
                <textarea class="form-control" name="specs[Thẻ SIM]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Hệ điều hành:</label>
                <textarea class="form-control" name="specs[Hệ điều hành]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Độ phân giải màn hình:</label>
                <textarea class="form-control" name="specs[Độ phân giải màn hình]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Loại CPU:</label>
                <textarea class="form-control" name="specs[Loại CPU]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Tính năng màn hình:</label>
                <textarea class="form-control" name="specs[Tính năng màn hình]" rows="3" required></textarea>
              </div>
              <div class="form-group">
                <label>Tương thích:</label>
                <textarea class="form-control" name="specs[Tương thích]" rows="3" required></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Macbook Form -->
        <div id="form-type-macbook" class="spec-form card" style="display: none">
          <div class="card-header">
            <h3 style="font-size: 20px; font-weight: 600">
              Thông số MacBook
            </h3>
          </div>
          <div class="card-body grid-container">
            <div class="form-row">
              <div class="form-group">
                <label>Kích thước màn hình:</label>
                <textarea class="form-control" name="specs[Kích thước màn hình]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Hệ điều hành:</label>
                <textarea class="form-control" name="specs[Hệ điều hành]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Độ phân giải màn hình:</label>
                <textarea class="form-control" name="specs[Độ phân giải màn hình]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Loại card đồ họa:</label>
                <textarea class="form-control" name="specs[Loại card đồ họa]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Dung lượng RAM:</label>
                <textarea class="form-control" name="specs[Dung lượng RAM]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Loại CPU:</label>
                <textarea class="form-control" name="specs[Loại CPU]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Công nghệ màn hình:</label>
                <textarea class="form-control" name="specs[Công nghệ màn hình]" rows="3" required></textarea>
              </div>
              <div class="form-group">
                <label>Pin:</label>
                <textarea class="form-control" name="specs[Pin]" rows="3" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group" style="flex: 1">
                <label>Cổng giao tiếp:</label>
                <textarea class="form-control" name="specs[Cổng giao tiếp]" rows="3" required></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Apple Watch Form -->
        <div id="form-type-watch" class="spec-form card" style="display: none">
          <div class="card-header">
            <h3 style="font-size: 20px; font-weight: 600">
              Thông số Apple Watch
            </h3>
          </div>
          <div class="card-body grid-container">
            <div class="form-row">
              <div class="form-group">
                <label>Công nghệ màn hình:</label>
                <textarea class="form-control" name="specs[Công nghệ màn hình]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Đường kính mặt:</label>
                <textarea class="form-control" name="specs[Đường kính mặt]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Kích thước cổ tay phù hợp:</label>
                <textarea class="form-control" name="specs[Kích thước cổ tay phù hợp]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Nghe, gọi:</label>
                <textarea class="form-control" name="specs[Nghe, gọi]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Tiện ích sức khoẻ:</label>
                <textarea class="form-control" name="specs[Tiện ích sức khoẻ]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Tương thích:</label>
                <textarea class="form-control" name="specs[Tương thích]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Thời lượng pin:</label>
                <textarea class="form-control" name="specs[Thời lượng pin]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Hãng sản xuất:</label>
                <textarea class="form-control" name="specs[Hãng sản xuất]" rows="2" required></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- AirPods Form -->
        <div id="form-type-airpods" class="spec-form card" style="display: none">
          <div class="card-header">
            <h3 style="font-size: 20px; font-weight: 600">
              Thông số AirPods
            </h3>
          </div>
          <div class="card-body grid-container">
            <div class="form-row">
              <div class="form-group">
                <label>Kích thước:</label>
                <textarea class="form-control" name="specs[Kích thước]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Trọng lượng:</label>
                <textarea class="form-control" name="specs[Trọng lượng]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Công nghệ âm thanh:</label>
                <textarea class="form-control" name="specs[Công nghệ âm thanh]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Micro:</label>
                <textarea class="form-control" name="specs[Micro]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Thời lượng sử dụng:</label>
                <textarea class="form-control" name="specs[Thời lượng sử dụng]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Pin:</label>
                <textarea class="form-control" name="specs[Pin]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Phương thức điều khiển:</label>
                <textarea class="form-control" name="specs[Phương thức điều khiển]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Chipset:</label>
                <textarea class="form-control" name="specs[Chipset]" rows="2" required></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Case Form -->
        <div id="form-type-op-lung-va-bao-da" class="spec-form card" style="display: none">
          <div class="card-header">
            <h3 style="font-size: 20px; font-weight: 600">
              Thông số Ốp lưng & Bao da
            </h3>
          </div>
          <div class="card-body grid-container">
            <div class="form-row">
              <div class="form-group">
                <label>Chất liệu:</label>
                <textarea class="form-control" name="specs[Chất liệu]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Loại bao da:</label>
                <textarea class="form-control" name="specs[Loại bao da]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Hỗ trợ sạc không dây:</label>
                <select class="form-control" name="specs[Hỗ trợ sạc không dây]" required>
                  <option value="Có">Có</option>
                  <option value="Không">Không</option>
                </select>
              </div>
              <div class="form-group">
                <label>Khả năng chống sốc:</label>
                <textarea class="form-control" name="specs[Khả năng chống sốc]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Khả năng chống nước:</label>
                <textarea class="form-control" name="specs[Khả năng chống nước]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Thiết kế:</label>
                <textarea class="form-control" name="specs[Thiết kế]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Thiết bị tương thích:</label>
                <textarea class="form-control" name="specs[Thiết bị tương thích]" rows="2" required></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Charger Form -->
        <div id="form-type-sac-va-cap" class="spec-form card" style="display: none">
          <div class="card-header">
            <h3 style="font-size: 20px; font-weight: 600">
              Thông số Sạc & Cáp
            </h3>
          </div>
          <div class="card-body grid-container">
            <div class="form-row">
              <div class="form-group">
                <label>Công suất:</label>
                <textarea class="form-control" name="specs[Công suất]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Loại sạc:</label>
                <textarea class="form-control" name="specs[Loại sạc]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Số cổng sạc:</label>
                <textarea class="form-control" name="specs[Số cổng sạc]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Chuẩn sạc nhanh:</label>
                <textarea class="form-control" name="specs[Chuẩn sạc nhanh]" rows="2" required></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Chất liệu vỏ:</label>
                <textarea class="form-control" name="specs[Chất liệu vỏ]" rows="2" required></textarea>
              </div>
              <div class="form-group">
                <label>Hỗ trợ sạc không dây:</label>
                <select class="form-control" name="specs[Hỗ trợ sạc không dây]" required>
                  <option value="Có">Có</option>
                  <option value="Không">Không</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Thiết bị tương thích:</label>
                <textarea class="form-control" name="specs[Thiết bị tương thích]" rows="2" required></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Form mặc định cho danh mục chưa có form riêng -->
        <div id="form-type-iphone" class="spec-form card" style="display: none">
          <div class="card-header">
            <h3 style="font-size: 20px; font-weight: 600">Thông số iPhone</h3>
          </div>
          <div class="card-body grid-container">
            <div class="form-group">
              <label>Kích thước màn hình:</label>
              <input type="text" class="form-control" name="specs[Kích thước màn hình]" />
            </div>
            <div class="form-group">
              <label>Bộ nhớ trong:</label>
              <input type="text" class="form-control" name="specs[Bộ nhớ trong]" />
            </div>
            <div class="form-group">
              <label>Camera:</label>
              <input type="text" class="form-control" name="specs[Camera]" />
            </div>
            <div class="form-group">
              <label>Pin:</label>
              <input type="text" class="form-control" name="specs[Pin]" />
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" onclick="prevStep(3)" class="prev-btn">
            Quay lại
          </button>
          <button type="submit" class="submit-btn">Hoàn tất</button>
        </div>
      </div>
    </form>
  </main>
  <script>
    function toggleSpecs(groupIdPrefix) {
      const rows = document.querySelectorAll(`tr[id^="${groupIdPrefix}"]`);
      rows.forEach((row) => {
        if (row.classList.contains("show")) {
          // Hiệu ứng thu lên
          row.style.maxHeight = "0";
          row.style.opacity = "0";
          setTimeout(() => {
            row.classList.remove("show");
          }, 300);
        } else {
          // Hiệu ứng trượt xuống
          row.classList.add("show");
          // Tính toán chiều cao thực tế
          const contentHeight = row.scrollHeight;
          row.style.maxHeight = `${contentHeight}px`;
          row.style.opacity = "1";
        }
      });
    }
    // Hàm để hiển thị form thông số kỹ thuật dựa trên categoryID
    function showFieldsByProductType() {
      // Lấy categoryID từ select box ở step1
      const categorySelect = document.getElementById("categorySelect");
      const categoryID = categorySelect.value;

      // Hiển thị tên sản phẩm ở step3
      const productNameInput =
        document.getElementById("productNameInput").value;
      document.getElementById("productNameDisplayStep3").value =
        productNameInput;

      // Ẩn và disable tất cả các form thông số
      document.querySelectorAll(".spec-form").forEach((form) => {
        form.style.display = "none";
        form.querySelectorAll("input, textarea, select").forEach((el) => {
          el.disabled = true;
        });
      });

      // Hiển thị form thông số phù hợp dựa trên categoryID
      let formToShow = null;
      if (categoryID === "1") {
        formToShow = document.getElementById("form-type-iphone");
      } else if (categoryID === "2") {
        formToShow = document.getElementById("form-type-ipad");
      } else if (categoryID === "3") {
        formToShow = document.getElementById("form-type-macbook");
      } else if (categoryID === "4") {
        formToShow = document.getElementById("form-type-airpods");
      } else if (categoryID === "5") {
        formToShow = document.getElementById("form-type-op-lung-va-bao-da");
      } else if (categoryID === "6") {
        formToShow = document.getElementById("form-type-sac-va-cap");
      } else if (categoryID === "7") {
        formToShow = document.getElementById("form-type-watch");
      }

      // Nếu không tìm thấy form cụ thể, hiển thị form mặc định
      if (!formToShow) {
        formToShow = document.getElementById("form-type-default");
      }

      // Hiển thị và enable form phù hợp
      if (formToShow) {
        formToShow.style.display = "block";
        formToShow
          .querySelectorAll("input, textarea, select")
          .forEach((el) => {
            el.disabled = false;
          });
      }
    }
  </script>

  <script>
    function nextStep(currentStep) {
      if (validateStep(currentStep)) {
        // Ẩn step hiện tại
        document.getElementById(`step${currentStep}`).style.display = "none";
        // Hiện step tiếp theo
        document.getElementById(`step${currentStep + 1}`).style.display =
          "block";

        // Nếu chuyển từ Step1 sang Step2 thì xử lý hiển thị tên sản phẩm
        if (currentStep === 1) {
          const productNameInput =
            document.getElementById("productNameInput");
          const categorySelect = document.getElementById("categorySelect");

          if (productNameInput && categorySelect) {
            const productName = productNameInput.value;
            const productID =
              document.querySelector('#step1 input[name="productID"]')
                .value || "new";
            const categoryName =
              categorySelect.options[categorySelect.selectedIndex].text;

            if (productName) {
              // Hiển thị tên sản phẩm ở Step2
              const productNameDisplayStep2 = document.getElementById(
                "productNameDisplayStep2"
              );
              if (productNameDisplayStep2) {
                productNameDisplayStep2.value = productName;
              }

              // Hiển thị tên sản phẩm và loại sản phẩm ở Step3
              const productNameDisplayStep3 = document.getElementById(
                "productNameDisplayStep3"
              );
              const categoryNameDisplay = document.getElementById(
                "categoryNameDisplay"
              );

              if (productNameDisplayStep3) {
                productNameDisplayStep3.value = productName;
              }
              if (categoryNameDisplay) {
                categoryNameDisplay.value = categoryName;
              }

              // Gán vào hidden input Step3
              document.getElementById("productId").value = productID;

              // Tự động kích hoạt hiển thị form
              setTimeout(() => {
                showFieldsByProductType();
              }, 100);
            }
          }
        }
      }
    }
    function prevStep(currentStep) {
      document.getElementById(`step${currentStep}`).style.display = "none";
      document.getElementById(`step${currentStep - 1}`).style.display =
        "block";
    }

    // Thêm hàm validate cho từng step
    function validateStep(step) {
      if (step === 1) {
        const productName = document
          .getElementById("productNameInput")
          .value.trim()
          .toLowerCase();
        // Kiểm tra trùng tên sản phẩm
        if (productNameList.includes(productName)) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Tên sản phẩm đã tồn tại, vui lòng nhập tên khác!",
          });
          return false;
        }

        const category = document.getElementById("categorySelect").value;
        const status = document.querySelector('select[name="status"]').value;
        const manufactureDate = document.querySelector(
          'input[name="manufactureDate"]'
        ).value;
        const productImage =
          document.getElementById("productImageFile").value;

        if (!productName) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Vui lòng nhập tên sản phẩm",
          });
          return false;
        }

        if (!category) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Vui lòng chọn loại sản phẩm",
          });
          return false;
        }

        if (!status) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Vui lòng chọn trạng thái",
          });
          return false;
        }

        if (!manufactureDate) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Vui lòng chọn ngày sản xuất",
          });
          return false;
        }
      } else if (step === 2) {
        // Validate step 2
        const quantity = document.querySelector(
          'input[name="quantityInStock"]'
        ).value;
        const price = document.getElementById("priceInput").value;
        const color = document.querySelector('input[name="color"]:checked');
        const variantImage =
          document.getElementById("variantImageFile").value;

        if (!quantity || quantity < 0) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Vui lòng nhập số lượng hợp lệ",
          });
          return false;
        }

        if (!price) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Vui lòng nhập giá sản phẩm",
          });
          return false;
        }

        if (!color) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Vui lòng chọn màu sắc",
          });
          return false;
        }

        if (!variantImage) {
          Swal.fire({
            icon: "error",
            title: "Lỗi",
            text: "Vui lòng chọn ảnh cho phiên bản",
          });
          return false;
        }
      } else if (step === 3) {
        const categoryID = document.getElementById("categorySelect").value;

        // Validate dựa trên loại sản phẩm
        if (categoryID === "1") {
          // iPhone
          const screenSize = document.querySelector(
            'textarea[name="specs[Kích thước màn hình]"]'
          ).value;
          const screenTech = document.querySelector(
            'textarea[name="specs[Công nghệ màn hình]"]'
          ).value;
          const chipset = document.querySelector(
            'textarea[name="specs[Chipset]"]'
          ).value;
          const ram = document.querySelector(
            'textarea[name="specs[Dung lượng RAM]"]'
          ).value;
          const os = document.querySelector(
            'textarea[name="specs[Hệ điều hành]"]'
          ).value;

          if (!screenSize || !screenTech || !chipset || !ram || !os) {
            Swal.fire({
              icon: "error",
              title: "Lỗi",
              text: "Vui lòng điền đầy đủ các thông số kỹ thuật bắt buộc",
            });
            return false;
          }
        } else if (categoryID === "2") {
          // iPad
          const screenSize = document.querySelector(
            'textarea[name="specs[Kích thước màn hình]"]'
          ).value;
          const screenTech = document.querySelector(
            'textarea[name="specs[Công nghệ màn hình]"]'
          ).value;
          const chipset = document.querySelector(
            'textarea[name="specs[Chipset]"]'
          ).value;
          const ram = document.querySelector(
            'textarea[name="specs[Dung lượng RAM]"]'
          ).value;
          const os = document.querySelector(
            'textarea[name="specs[Hệ điều hành]"]'
          ).value;

          if (!screenSize || !screenTech || !chipset || !ram || !os) {
            Swal.fire({
              icon: "error",
              title: "Lỗi",
              text: "Vui lòng điền đầy đủ thông số kỹ thuật cho iPad",
            });
            return false;
          }
        } else if (categoryID === "3") {
          // Macbook
          const screenSize = document.querySelector(
            'textarea[name="specs[Kích thước màn hình]"]'
          ).value;
          const os = document.querySelector(
            'textarea[name="specs[Hệ điều hành]"]'
          ).value;
          const ram = document.querySelector(
            'textarea[name="specs[Dung lượng RAM]"]'
          ).value;
          const cpu = document.querySelector(
            'textarea[name="specs[Loại CPU]"]'
          ).value;
          const gpu = document.querySelector(
            'textarea[name="specs[Loại card đồ họa]"]'
          ).value;

          if (!screenSize || !os || !ram || !cpu || !gpu) {
            Swal.fire({
              icon: "error",
              title: "Lỗi",
              text: "Vui lòng điền đầy đủ thông số kỹ thuật cho MacBook",
            });
            return false;
          }
        } else if (categoryID === "4") {
          // AirPods
          const weight = document.querySelector(
            'textarea[name="specs[Trọng lượng]"]'
          ).value;
          const batteryLife = document.querySelector(
            'textarea[name="specs[Thời lượng sử dụng]"]'
          ).value;
          const audioTech = document.querySelector(
            'textarea[name="specs[Công nghệ âm thanh]"]'
          ).value;
          const chipset = document.querySelector(
            'textarea[name="specs[Chipset]"]'
          ).value;

          if (!weight || !batteryLife || !audioTech || !chipset) {
            Swal.fire({
              icon: "error",
              title: "Lỗi",
              text: "Vui lòng điền đầy đủ thông số kỹ thuật cho AirPods",
            });
            return false;
          }
        } else if (categoryID === "5") {
          // Ốp lưng & Bao da
          const material = document.querySelector(
            'textarea[name="specs[Chất liệu]"]'
          ).value;
          const design = document.querySelector(
            'textarea[name="specs[Thiết kế]"]'
          ).value;
          const compatibility = document.querySelector(
            'textarea[name="specs[Thiết bị tương thích]"]'
          ).value;

          if (!material || !design || !compatibility) {
            Swal.fire({
              icon: "error",
              title: "Lỗi",
              text: "Vui lòng điền đầy đủ thông số kỹ thuật cho Ốp lưng/Bao da",
            });
            return false;
          }
        } else if (categoryID === "6") {
          // Sạc & Cáp
          const power = document.querySelector(
            'textarea[name="specs[Công suất]"]'
          ).value;
          const chargerType = document.querySelector(
            'textarea[name="specs[Loại sạc]"]'
          ).value;
          const compatibility = document.querySelector(
            'textarea[name="specs[Thiết bị tương thích]"]'
          ).value;

          if (!power || !chargerType || !compatibility) {
            Swal.fire({
              icon: "error",
              title: "Lỗi",
              text: "Vui lòng điền đầy đủ thông số kỹ thuật cho Sạc/Cáp",
            });
            return false;
          }
        } else if (categoryID === "7") {
          // Apple Watch
          const screenTech = document.querySelector(
            'textarea[name="specs[Công nghệ màn hình]"]'
          ).value;
          const diameter = document.querySelector(
            'textarea[name="specs[Đường kính mặt]"]'
          ).value;
          const battery = document.querySelector(
            'textarea[name="specs[Thời lượng pin]"]'
          ).value;
          const compatibility = document.querySelector(
            'textarea[name="specs[Tương thích]"]'
          ).value;

          if (!screenTech || !diameter || !battery || !compatibility) {
            Swal.fire({
              icon: "error",
              title: "Lỗi",
              text: "Vui lòng điền đầy đủ thông số kỹ thuật cho Apple Watch",
            });
            return false;
          }
        }
      }

      return true;
    }

    document.querySelector("form").addEventListener("submit", function (e) {
      e.preventDefault();

      if (!validateStep(3)) {
        return;
      }

      const formData = new FormData(this);

      fetch(this.action, {
        method: "POST",
        body: formData,
      })
        .then((response) => {
          if (response.ok) {
            Swal.fire({
              icon: "success",
              title: "Thành công!",
              text: "Đã thêm sản phẩm thành công",
              showConfirmButton: true,
              confirmButtonText: "OK",
            }).then((result) => {
              if (result.isConfirmed) {
                window.location.href = "/admin-addPVP"; // Reload trang sau khi thêm
              }
            });
          } else {
            throw new Error("Có lỗi xảy ra");
          }
        })
        .catch((error) => {
          Swal.fire({
            icon: "error",
            title: "Lỗi!",
            text: "Đã xảy ra lỗi khi thêm sản phẩm: " + error.message,
          });
        });
    });

    function submitAllForms() {
      const specForm = document.getElementById("specForm");
      specForm.submit();
    }
  </script>

  <script>
    // Format giá tiền khi nhập
    document
      .getElementById("priceInput")
      .addEventListener("input", function (e) {
        let value = e.target.value.replace(/\D/g, "");
        if (value) {
          value = parseInt(value, 10).toLocaleString("vi-VN");
          e.target.value = value;
        }
      });

    // Chuyển đổi giá trước khi submit form
    document.querySelector("form").addEventListener("submit", function (e) {
      const priceInput = document.getElementById("priceInput");
      const priceHidden = document.querySelector('input[name="price"]');

      if (priceInput && priceHidden) {
        const cleanedPrice = priceInput.value.replace(/[.,\s]/g, "");
        priceHidden.value = cleanedPrice;
      }
    });
  </script>
  <script>
    // JavaScript để xử lý preview ảnh
    const fileInput = document.getElementById("productImageFile");
    const previewImg = document.getElementById("previewImage");

    fileInput.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          previewImg.src = e.target.result;
          previewImg.classList.remove("hidden"); // Hiện ảnh
        };
        reader.readAsDataURL(file);
      } else {
        previewImg.src = "";
        previewImg.classList.add("hidden"); // Ẩn nếu bỏ chọn
      }
    });
  </script>

  <script>
    // JavaScript để xử lý preview ảnh cho variant
    const variantFileInput = document.getElementById("variantImageFile");
    const variantPreviewImg = document.getElementById("variantPreviewImage");
    const variantPreviewImgEmpty = document.getElementById(
      "variantPreviewImageEmpty"
    );

    variantFileInput.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          if (variantPreviewImg) {
            variantPreviewImg.src = e.target.result;
            variantPreviewImg.classList.remove("hidden");
          } else {
            variantPreviewImgEmpty.src = e.target.result;
            variantPreviewImgEmpty.classList.remove("hidden");
          }
        };
        reader.readAsDataURL(file);
      }
    });
  </script>

  <script>
    // Trước khi submit, disable tất cả các input/textarea/select trong các form spec-form đang bị ẩn
    document.querySelector("form").addEventListener("submit", function (e) {
      document.querySelectorAll(".spec-form").forEach((form) => {
        if (form.style.display === "none") {
          form.querySelectorAll("input, textarea, select").forEach((el) => {
            el.disabled = true;
          });
        } else {
          form.querySelectorAll("input, textarea, select").forEach((el) => {
            el.disabled = false;
          });
        }
      });
    });
  </script>
  <script th:inline="javascript">
    /*<![CDATA[*/
    // Lấy danh sách tên sản phẩm từ server (dưới dạng mảng string)
    const productNameList = /*[[${productNames}]]*/[];
    /*]]>*/
  </script>
</body>

</html>