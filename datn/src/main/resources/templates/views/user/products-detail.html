<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Th√¥ng tin chi ti·∫øt s·∫£n ph·∫©m</title>
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
  <script>tailwind.config = { theme: { extend: { colors: { primary: '#e11d48', secondary: '#f97316' }, borderRadius: { 'none': '0px', 'sm': '4px', DEFAULT: '8px', 'md': '12px', 'lg': '16px', 'xl': '20px', '2xl': '24px', '3xl': '32px', 'full': '9999px', 'button': '8px' } } } }</script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="/css/shared/footer.css">
  <link rel="stylesheet" href="/css/shared/header.css">
  <link rel="stylesheet" href="/css/shared/chatbox.css">
  <style>
    :where([class^="ri-"])::before {
      content: "\f3c2";
    }

    body {
      font-family: "Roboto", sans-serif;
    }

    .banner-slide {
      transition: transform 0.5s ease;
    }

    .custom-scrollbar::-webkit-scrollbar {
      height: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #e11d48;
      border-radius: 4px;
    }

    input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid #e2e8f0;
      border-radius: 4px;
      position: relative;
      cursor: pointer;
    }

    input[type="checkbox"]:checked {
      background-color: #e11d48;
      border-color: #e11d48;
    }

    input[type="checkbox"]:checked::after {
      content: "";
      position: absolute;
      top: 2px;
      left: 5px;
      width: 5px;
      height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: white;
      min-width: 200px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      z-index: 50;
      border-radius: 8px;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    .border-custom-blue {
      border-color: #000f8f;
      /* M√†u xanh t√πy ch·ªânh */
    }

    .thumbnail.active {
      border-color: #3b82f6 !important;
      /* blue-500 */
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
      /* glow effect */
    }
  </style>

  <style>
    .product-images-wrapper {
      height: calc(100% + 200px);
      /* Th√™m 200px v√†o chi·ªÅu cao t·ª± nhi√™n */
    }

    .product-images-scrollable {
      position: sticky;
      top: 20px;
      transition: transform 0.3s ease;
      will-change: transform;
    }

    @media (min-width: 1024px) {
      .product-images-scrollable {
        transform: translateY(0);
        max-height: calc(100vh - 40px);
      }

      /* Khi scroll v∆∞·ª£t qu√° 200px */
      body.scrolled .product-images-scrollable {
        transform: translateY(200px);
      }
    }
  </style>

  <!-- N√∫t xem t·∫•t c·∫£ -->
  <style>
    .xem-tat-ca-btn {
      display: block;
      margin: 16px auto 0;
      padding: 8px 24px;
      border: 1px solid #000f8f;
      color: #000f8f;
      border-radius: 4px;
      background-color: transparent;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .xem-tat-ca-btn:hover {
      background-color: #000f8f;
      color: white;
    }

    .xem-tat-ca-btn:hover .arrow-icon {
      transform: translateX(10px);
    }

    .arrow-icon {
      transition: transform 0.3s ease;
    }
  </style>
</head>

<body class="bg-[#f2f2f2]">
  <!-- Header -->
  <div th:insert="views/shared/header :: siteHeader" style="margin-top: 120px;"></div>
  <!-- chatbox -->
  <div th:insert="views/shared/chatbot :: siteChatbot"></div>
  <!-- Zalo icon -->
  <div th:insert="views/shared/zalo :: siteZalo"></div>

  <section class="py-8">
    <div class="container mx-auto px-4">
      <!-- ƒêo·∫°n 1 -->
      <div class="bg-white rounded-lg p-6 mb-6 shadow-[0_0_15px_rgba(0,0,0,0.1)]"
        style="max-width: 1250px; margin: auto">
        <!-- Ti√™u ƒë·ªÅ s·∫£n ph·∫©m -->
        <div class="flex items-center justify-between mb-8">
          <div class="w-full">
            <h2 class="text-xl font-bold pb-3 border-b border-gray-700" style="font-size: 23px;">
              <span th:text="${v.product.productName} ">T√™n s·∫£n ph·∫©m</span>
              <span> </span>
              <span th:text="${v.storage} + ' - ' + 'Ch√≠nh h√£ng VN'">Dung l∆∞·ª£ng</span>
              <span></span>
            </h2>
          </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-8">
          <!-- Ph·∫ßn 1: ·∫¢nh s·∫£n ph·∫©m -->
          <div class="product-images-wrapper relative lg:w-1/3">
            <div class="product-images-scrollable">
              <!-- ·∫¢nh l·ªõn ch√≠nh -->
              <div class="main-image mb-3">
                <img id="main-image" th:src="@{'/images/' + ${v.imagesno2}}" th:alt="${v.product.productName}"
                  class="w-full h-auto transition-opacity duration-300" />
              </div>

              <!-- ·∫¢nh nh·ªè ph√≠a d∆∞·ªõi -->
              <div class="thumbnail-images grid grid-cols-4 gap-2 w-full">
                <!-- L·∫∑p qua c√°c bi·∫øn th·ªÉ c√πng dung l∆∞·ª£ng -->
                <div th:each="variant : ${sameStorageVariants}"
                  class="thumbnail cursor-pointer border-2 rounded-lg transition-all p-1 flex items-center justify-center bg-gray-50"
                  th:classappend="${v.variantID == variant.variantID} ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-300' : 'border-transparent'">
                  <a th:href="@{'/detail/' + ${variant.variantID}}">
                    <img th:src="@{'/images/' + ${variant.imagesno2}}" th:alt="${variant.color}"
                      class="h-auto max-w-full object-contain" />
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Ph·∫ßn 2: Th√¥ng tin c∆° b·∫£n v√† gi√° -->
          <div class="lg:w-2/4" style="margin-right: -20px">
            <!-- Th√¥ng tin c∆° b·∫£n -->
            <div class="mb-6">
              <div class="mb-4">
                <div class="grid grid-cols-2 gap-x-8 gap-y-2">
                  <p style="color: #000f8f; font-weight: 600">
                    <span class="text-gray-600" style="font-weight: 500">Lo·∫°i:</span>
                    <span th:text="${v.product.category.name}">T√™n danh m·ª•c</span>
                  </p>

                  <p style="color: #000f8f; font-weight: 500">
                    <span class="text-gray-600" style="font-weight: 500">T√¨nh tr·∫°ng:</span>
                    <span th:if="${v.quantityInStock > 0}" style="color: #000f8f; font-weight: 600;">C√≤n h√†ng</span>
                    <span th:unless="${v.quantityInStock > 0}" style="color: #000f8f; font-weight: 600;">H·∫øt h√†ng</span>
                  </p>
                </div>
              </div>

              <!-- Gi√° b√°n -->
              <div class="mb-6" style="margin-bottom: 3px">
                <h2 class="text-[16px] text-gray-800 font-medium mb-2" style="margin-bottom: 0px; font-weight: 600;">
                  Gi√° b√°n:
                </h2>
                <div class="flex items-center space-x-4">
                  <!-- N·∫øu c√≥ gi·∫£m gi√° -->
                  <div th:if="${v.discountedPrice < v.price}" class="flex items-center gap-2">
                    <!-- Gi√° ƒë√£ gi·∫£m -->
                    <h2 class=" font-bold text-red-600 m-0" style="font-size: 37px;"
                      th:text="${#strings.replace(#numbers.formatDecimal(v.discountedPrice, 0, 'COMMA', 0, 'POINT'), ',', '.')} + ' ‚Ç´'">
                    </h2>

                    <!-- Gi√° g·ªëc g·∫°ch ngang -->
                    <span class="text-base text-gray-500 line-through"
                      th:text="${#strings.replace(#numbers.formatDecimal(v.price, 0, 'COMMA', 0, 'POINT'), ',', '.')} + ' ‚Ç´'">
                    </span>

                    <!-- Ph·∫ßn trƒÉm gi·∫£m -->
                    <span class="bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded"
                      th:text="'-' + ${v.discount} + '%'">
                    </span>
                  </div>

                  <!-- N·∫øu kh√¥ng gi·∫£m -->
                  <div th:if="${v.discountedPrice == v.price}">
                    <h2 class="text-2xl font-bold text-red-600"
                      style="font-size: 37px; margin-top: 11px; margin-bottom: 12px;"
                      th:text="${#strings.replace(#numbers.formatDecimal(v.price, 0, 'COMMA', 0, 'POINT'), ',', '.')} + ' ‚Ç´'">
                    </h2>
                  </div>


                </div>
              </div>

              <!-- Dung l∆∞·ª£ng -->
              <div class="mb-6 mt-2">
                <h2 class="text-[16px] text-gray-800 font-medium mb-2" style="font-weight: 600; margin-bottom: 5px;">
                  Dung l∆∞·ª£ng:</h2>
                <div class="flex gap-4 flex-wrap">
                  <!-- Ch·ªâ hi·ªÉn th·ªã n·∫øu c√≥ dung l∆∞·ª£ng -->
                  <div th:each="variant : ${uniqueVariantsByStorage}"
                    th:if="${variant.storage != null and !#strings.isEmpty(variant.storage)}" class="w-full sm:w-auto">

                    <a th:href="@{/detail/{id}(id=${variant.variantID})}">
                      <label
                        class="relative border-2 border-gray-300 rounded-md px-6 py-3 cursor-pointer hover:border-blue-500 transition-all text-center block w-[150px]"
                        th:classappend="${v.storage == variant.storage} ? ' border-blue-500 bg-blue-50 ring-2 ring-blue-300' : ''">

                        <!-- Hi·ªÉn th·ªã dung l∆∞·ª£ng -->
                        <span class="block font-medium text-gray-900" style="font-weight: 500;"
                          th:text="${variant.storage}">Dung l∆∞·ª£ng</span>

                        <!-- Hi·ªÉn th·ªã gi√° cu·ªëi c√πng -->
                        <span class="text-red-600 font-semibold block mt-1"
                          th:text="${#numbers.formatInteger(variant.discountedPrice, 0, 'POINT')} + 'ƒë'">Gi√°</span>

                        <!-- D·∫•u tick khi ch·ªçn -->
                        <span
                          class="absolute -top-2 -left-2 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center"
                          th:classappend="${v.storage == variant.storage} ? 'opacity-100' : 'opacity-0'">‚úî</span>
                      </label>
                    </a>
                  </div>
                </div>
              </div>

              <!-- M√†u s·∫Øc -->
              <div class="mb-6" style="margin-bottom: 10px">
                <h2 class="text-[16px] text-gray-800 font-medium mb-3"
                  style="margin-bottom: 0px; font-weight: 600; margin-top: -10px;">
                  M√†u s·∫Øc:
                </h2>
                <div class="flex flex-wrap gap-3">
                  <label th:each="variant, iterStat : ${sameStorageVariants}"
                    class="relative border-2 border-gray-300 rounded-lg p-1 cursor-pointer hover:border-blue-400 transition-all has-[:checked]:border-blue-500 has-[:checked]:ring-2 has-[:checked]:ring-blue-200">

                    <input type="radio" name="mausac" th:value="${variant.color}" class="hidden peer color-option"
                      th:checked="${v.variantID == variant.variantID}" th:attr="data-variant-id=${variant.variantID}" />

                    <div
                      class="w-16 h-16 flex items-center justify-center border-none peer-checked:border-white peer-checked:ring-2 peer-checked:ring-white rounded-lg transition-all">
                      <img th:src="@{'/images/' + ${variant.imagesno2}}" th:alt="${variant.color}"
                        class="h-full object-contain" />
                    </div>


                    <span class="block text-center text-xs mt-1 peer-checked:text-blue-600"
                      th:text="${variant.color}"></span>

                    <span
                      class="absolute -top-2 -right-2 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center opacity-0 peer-checked:opacity-100">‚úî</span>
                  </label>
                </div>
              </div>

              <!-- S·ªë l∆∞·ª£ng -->
              <div class="mb-6" style="margin-bottom: 10px">
                <h2 class="text-[15px] font-medium mb-3" style="margin-bottom: 2px">
                  S·ªë l∆∞·ª£ng:
                </h2>
                <div class="flex items-center">
                  <!-- N√∫t gi·∫£m -->
                  <button type="button" id="decreaseQty"
                    class="quantity-btn bg-[#000f8f] text-white w-8 h-8 flex items-center justify-center rounded-sm hover:bg-[#000b6e]">
                    <i class="ri-subtract-line"></i>
                  </button>

                  <!-- Input s·ªë l∆∞·ª£ng -->
                  <input type="number" id="quantity" value="1" min="1" max="99"
                    class="quantity-input w-12 h-8 text-center border-t border-b border-gray-300 mx-1" />

                  <!-- N√∫t tƒÉng -->
                  <button type="button" id="increaseQty" style="margin-left: -5px;"
                    class="quantity-btn bg-[#000f8f] text-white w-8 h-8 flex items-center justify-center rounded-sm hover:bg-[#000b6e]">
                    <i class="ri-add-line"></i>
                  </button>
                </div>

              </div>

              <!-- Th√™m v√†o gi·ªè -->
              <div class="mb-6 space-y-4" style="margin-bottom: 10px">

                <!-- H√†ng 1: N√∫t TH√äM V√ÄO GI·ªé (to nh·∫•t) -->
                <button
                  class="w-full h-[60px] bg-yellow-500 hover:bg-yellow-600 text-white py-4 px-6 rounded-sm transition-all duration-300 flex flex-col items-center justify-center transform hover:-translate-y-1 shadow-md hover:shadow-lg"
                  style="margin-bottom: -5px" th:attr="data-variant-id=${v.variantID}" onclick="addToCart(this)">

                  <span class="font-medium text-medium" style="margin-top: 10px">TH√äM V√ÄO GI·ªé</span>
                  <span class="text-sm" style="margin-bottom: 8px">Giao h√†ng t·∫≠n n∆°i mi·ªÖn ph√≠</span>
                </button>


                <!-- H√†ng 2: 2 n√∫t MUA NGAY v√† LI√äN H·ªÜ c√πng h√†ng -->
                <div class="grid grid-cols-2 gap-4">
                  <!-- N√∫t MUA NGAY -->
                  <button
                    class="bg-[#000f8f] hover:bg-[#000d7a] h-[60px] text-white py-3 px-4 rounded-sm transition-all duration-300 flex flex-col items-center justify-center transform hover:-translate-y-1 shadow-md hover:shadow-lg">
                    <span class="font-medium text-medium">MUA NGAY</span>
                  </button>

                  <!-- N√∫t LI√äN H·ªÜ -->
                  <button
                    class="bg-[#000f8f] hover:bg-[#000d7a] h-[60px] text-white py-3 px-4 rounded-sm transition-all duration-300 flex flex-col items-center justify-center transform hover:-translate-y-1 shadow-md hover:shadow-lg">
                    <span class="font-medium text-sm">Li√™n h·ªá
                      <span class="text-[18px]">1900 xxxx</span></span>
                    <span class="text-sm mt-1">ƒê·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n v√† h·ªó tr·ª£ ngay!!!</span>
                  </button>
                </div>
              </div>

              <!-- ∆Øu ƒë√£i khi mua h√†ng -->
              <div class="border-[1.5px] border-black rounded-xl overflow-hidden text-sm" style="margin-bottom: -30px">
                <!-- Ti√™u ƒë·ªÅ v·ªõi n·ªÅn xanh ƒë·∫≠m + icon -->
                <div class="bg-[#000f8f] text-white px-4 py-3 flex items-center font-semibold"
                  style="margin-bottom: -10px">
                  <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      d="M2 7h16v10a2 2 0 01-2 2H4a2 2 0 01-2-2V7zm16-2V3a1 1 0 00-1-1h-2.28a2 2 0 00-3.92 0H9.2a2 2 0 00-3.92 0H3a1 1 0 00-1 1v2h16z" />
                  </svg>
                  ∆Øu ƒë√£i khi mua h√†ng
                </div>

                <!-- Danh s√°ch ∆∞u ƒë√£i -->
                <ul class="p-4 space-y-2 text-[15px]">
                  <li class="flex items-start">
                    <span class="text-purple-500 mr-2 mt-1">‚úî</span>
                    <span>H·ªó tr·ª£ tr·∫£ g√≥p 0% ch·ªâ c·∫ßn CCCD g·∫Øn chip ho·∫∑c 0% qua th·∫ª
                      t√≠n d·ª•ng</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-purple-500 mr-2 mt-1">‚úî</span>
                    <span>Nh·∫≠p m√£ <strong>ZALOPAYMT</strong> gi·∫£m ngay 1% t·ªëi ƒëa
                      <strong>200.000ƒë</strong> khi thanh to√°n qua Zalo
                      Pay</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-purple-500 mr-2 mt-1">‚úî</span>
                    <span>Gi·∫£m 50% t·ªëi ƒëa <strong>100.000ƒë</strong> cho th√†nh
                      vi√™n m·ªõi c·ªßa Kredivo</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-purple-500 mr-2 mt-1">‚úî</span>
                    <span>Gi·∫£m 5% t·ªëi ƒëa <strong>200.000ƒë</strong>, √°p d·ª•ng k·ª≥
                      h·∫°n 6/12 th√°ng khi thanh to√°n qua Kredivo</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-purple-500 mr-2 mt-1">‚úî</span>
                    <span>Gi·∫£m 50% t·ªëi ƒëa <strong>100.000ƒë</strong>, √°p d·ª•ng cho
                      ƒë∆°n h√†ng t·ª´ <strong>200.000ƒë</strong> cho ng∆∞·ªùi d√πng m·ªõi
                      c·ªßa Home Pay Later</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-purple-500 mr-2 mt-1">‚úî</span>
                    <span>Gi·∫£m 5% t·ªëi ƒëa <strong>200.000ƒë</strong> cho ƒë∆°n t·ª´
                      <strong>200.000ƒë</strong> khi thanh to√°n qua Home
                      PayLater</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Ph·∫ßn 3: Th√¥ng tin mua h√†ng -->
          <div class="lg:w-2/7">
            <!-- H·ªá th·ªëng c·ª≠a h√†ng -->
            <div class="border-[1.5px] border-black rounded-md overflow-hidden text-sm mb-5"
              style="margin-bottom: 20px">
              <!-- Ti√™u ƒë·ªÅ -->
              <div class="bg-[#000f8f] text-white px-4 py-3 flex items-center font-semibold"
                style="margin-bottom: -10px; padding-left: 7px">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M10.707 1.293a1 1 0 00-1.414 0L3 7.586V17a1 1 0 001 1h4a1 1 0 001-1v-4h2v4a1 1 0 001 1h4a1 1 0 001-1V7.586l-6.293-6.293z" />
                </svg>H·ªá th·ªëng c·ª≠a h√†ng
              </div>

              <!-- Danh s√°ch c·ª≠a h√†ng -->
              <div class="p-4 space-y-4 text-[15px] leading-snug" style="padding-left: px">
                <div>
                  <p class="text-[#000f8f] font-semibold">Hope S√†i G√≤n</p>
                  <p><strong>ƒê·ªãa ch·ªâ:</strong> 123 L√™ L·ª£i, Qu·∫≠n 1, TP.HCM</p>
                </div>
                <div>
                  <p class="text-[#000f8f] font-semibold">Hope H√† N·ªôi</p>
                  <p>
                    <strong>ƒê·ªãa ch·ªâ:</strong> 456 Ph·ªë Hu·∫ø, Hai B√† Tr∆∞ng, H√†
                    N·ªôi
                  </p>
                </div>
                <div>
                  <p class="text-[#000f8f] font-semibold">Hope ƒê√† N·∫µng</p>
                  <p>
                    <strong>ƒê·ªãa ch·ªâ:</strong> 789 Nguy·ªÖn VƒÉn Linh, H·∫£i Ch√¢u,
                    ƒê√† N·∫µng
                  </p>
                </div>
                <div>
                  <p class="text-[#000f8f] font-semibold">Hope C·∫ßn Th∆°</p>
                  <p>
                    <strong>ƒê·ªãa ch·ªâ:</strong> 321 H√πng V∆∞∆°ng, Ninh Ki·ªÅu, C·∫ßn
                    Th∆°
                  </p>
                </div>
              </div>
            </div>

            <!-- Cam k·∫øt b√°n h√†ng -->
            <div class="border-[1.5px] border-black rounded-md overflow-hidden text-sm mb-5"
              style="margin-bottom: 20px">
              <div class="rounded-md overflow-hidden w-full max-w-md">
                <!-- Ti√™u ƒë·ªÅ -->
                <div class="bg-[#000f8f] text-white px-4 py-2 flex items-center space-x-2" style="margin-bottom: -8px">
                  <i class="fa-solid fa-bookmark text-white"></i>
                  <h3 class="text-base font-semibold">Cam k·∫øt b√°n h√†ng</h3>
                </div>

                <!-- N·ªôi dung -->
                <ul class="p-4 space-y-3 text-[15px] leading-snug">
                  <li class="flex items-start space-x-2">
                    <i class="fa-solid fa-shield-halved text-gray-700 pt-1"></i>
                    <span>H√†ng ch√≠nh h√£ng. Ngu·ªìn g·ªëc r√µ r√†ng</span>
                  </li>
                  <li class="flex items-start space-x-2">
                    <i class="fa-solid fa-gift text-gray-700 pt-1"></i>
                    <span>T·∫∑ng m√°y n·∫øu ph√°t hi·ªán m√°y s·ª≠a ch·ªØa</span>
                  </li>
                  <li class="flex items-start space-x-2">
                    <i class="fa-solid fa-truck-fast text-gray-700 pt-1"></i>
                    <span>Giao h√†ng ngay (n·ªôi th√†nh TPHCM)</span>
                  </li>
                  <li class="flex items-start space-x-2">
                    <i class="fa-solid fa-calendar-check text-gray-700 pt-1"></i>
                    <span>D√πng th·ª≠ 7 ng√†y mi·ªÖn ph√≠</span>
                  </li>
                </ul>
              </div>
            </div>

            <!-- Danh s√°ch khuy·∫øn m√£i -->
            <div class="border-[1.5px] border-black rounded-md overflow-hidden text-sm mb-5"
              style="margin-bottom: 10px">
              <div class="rounded-md overflow-hidden w-full max-w-md">
                <!-- Ti√™u ƒë·ªÅ -->
                <div class="bg-[#000f8f] text-white px-4 py-2 flex items-center space-x-2" style="margin-bottom: -8px">
                  <i class="fa-solid fa-bolt"></i>

                  <h3 class="text-base font-semibold">
                    Danh s√°ch khuy·∫øn m√£i
                  </h3>
                </div>
                <!-- N·ªôi dung -->
                <ul class="p-4 space-y-3 text-[15px] leading-snug">
                  <li class="flex items-start space-x-2">
                    <i class="fa-solid fa-check" style="margin-top: 6px"></i>
                    <span>√Åp d·ª•ng Phi·∫øu qu√† t·∫∑ng/ M√£ gi·∫£m gi√° theo s·∫£n
                      ph·∫©m.</span>
                  </li>
                  <li class="flex items-start space-x-2">
                    <i class="fa-solid fa-check" style="margin-top: 6px"></i>
                    <span>Gi·∫£m gi√° 10% khi mua t·ª´ 5 s·∫£n ph·∫©m.</span>
                  </li>
                  <li class="flex items-start space-x-2">
                    <i class="fa-solid fa-gift" style="margin-top: 6px"></i>
                    <span>T·∫∑ng 100.000‚Ç´ cho th√†nh vi√™n Dola.</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ƒêo·∫°n 2 -->
      <div class="flex gap-4" style="max-width: 1250px; margin: auto; margin-top: 20px">
        <!-- Ph·∫ßn 6/10 -->

        <div class="w-6/10 flex-6 basis-3/5 bg-white rounded-lg p-6 mb-6 shadow-[0_0_15px_rgba(0,0,0,0.1)]">
          <div class="flex items-center justify-between mb-8" style="margin-bottom: 5px">
            <h2 class="text-2xl font-bold border-l-8 border-custom-blue pl-4">
              ƒê√ÅNH GI√Å S·∫¢N PH·∫®M
            </h2>
          </div>

          <!-- Product Review Section -->
          <div class="bg-[#f5f9f6] p-4 rounded-md border text-sm">
            <!-- Overview + Filter -->
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4 mb-5">
              <!-- Overview -->
              <div class="text-center lg:text-left" style="margin-left: 28px">
                <p class="text-2xl text-green-600 font-semibold" style="margin-left: 9px" id="average-rating">
                  0/5
                </p>
                <div class="flex justify-center lg:justify-start text-yellow-500 mb-1" id="average-stars">
                  <i class="fa-solid fa-star"></i>
                  <i class="fa-solid fa-star"></i>
                  <i class="fa-solid fa-star"></i>
                  <i class="fa-solid fa-star"></i>
                  <i class="fa-solid fa-star"></i>
                </div>
                <p class="text-gray-600" id="total-reviews">(0 ƒë√°nh gi√°)</p>
                <button id="openReviewModal" style="margin-left: -36px"
                  class="mt-2 px-4 py-1.5 bg-green-600 text-white rounded hover:bg-green-700 text-sm">
                  G·ª≠i ƒë√°nh gi√° c·ªßa b·∫°n
                </button>
              </div>

              <!-- Review Filter -->
              <div class="flex flex-wrap justify-center gap-2 p-2 rounded-md border-gray-800">
                <button data-rating="5"
                  class="filter-button border border-gray-300 px-3 py-1 rounded-md hover:bg-gray-100 hover:border-gray-500 transition-all">
                  5 sao (0)
                </button>
                <button data-rating="4"
                  class="filter-button border border-gray-300 px-3 py-1 rounded-md hover:bg-gray-100 hover:border-gray-500 transition-all">
                  4 sao (0)
                </button>
                <button data-rating="3"
                  class="filter-button border border-gray-300 px-3 py-1 rounded-md hover:bg-gray-100 hover:border-gray-500 transition-all">
                  3 sao (0)
                </button>
                <button data-rating="2"
                  class="filter-button border border-gray-300 px-3 py-1 rounded-md hover:bg-gray-100 hover:border-gray-500 transition-all">
                  2 sao (0)
                </button>
                <button data-rating="1"
                  class="filter-button border border-gray-300 px-3 py-1 rounded-md hover:bg-gray-100 hover:border-gray-500 transition-all">
                  1 sao (0)
                </button>
                <button data-rating="0"
                  class="filter-button border border-gray-300 px-3 py-1 rounded-md hover:bg-gray-100 hover:border-gray-500 transition-all active-filter">
                  T·∫•t c·∫£
                </button>
              </div>
            </div>

            <!-- Reviews List -->
            <div class="space-y-6" id="reviews-container">
              <!-- Reviews will be loaded here dynamically -->
            </div>
          </div>
        </div>

        <!-- Review Modal -->
        <div id="reviewModal"
          class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center hidden z-50 transition-opacity duration-300">
          <div
            class="bg-white rounded-xl shadow-2xl overflow-hidden w-full max-w-lg mx-4 transform transition-all duration-300 scale-95 hover:scale-100">
            <!-- Modal Header -->
            <div class="bg-[#000f8f] p-6">
              <h3 class="text-2xl font-bold text-white">ƒê√°nh gi√° s·∫£n ph·∫©m</h3>
              <p class="text-blue-100">Chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n v·ªÅ s·∫£n ph·∫©m</p>
            </div>

            <!-- Modal Content -->
            <div class="p-6 space-y-6">
              <!-- Rating Section -->
              <div class="space-y-2">
                <label class="block text-gray-700 font-medium">ƒê√°nh gi√° c·ªßa b·∫°n</label>
                <div class="flex text-3xl space-x-2 rating-stars">
                  <i class="fa-regular fa-star cursor-pointer text-amber-400 hover:text-amber-500 transition-colors"
                    data-value="1"></i>
                  <i class="fa-regular fa-star cursor-pointer text-amber-400 hover:text-amber-500 transition-colors"
                    data-value="2"></i>
                  <i class="fa-regular fa-star cursor-pointer text-amber-400 hover:text-amber-500 transition-colors"
                    data-value="3"></i>
                  <i class="fa-regular fa-star cursor-pointer text-amber-400 hover:text-amber-500 transition-colors"
                    data-value="4"></i>
                  <i class="fa-regular fa-star cursor-pointer text-amber-400 hover:text-amber-500 transition-colors"
                    data-value="5"></i>
                </div>
                <input type="hidden" id="ratingValue" value="0">
                <p class="text-sm text-gray-500">Nh·∫•n ƒë·ªÉ ch·ªçn s·ªë sao</p>
              </div>

              <!-- Comment Section -->
              <div class="space-y-2">
                <label for="reviewComment" class="block text-gray-700 font-medium">B√¨nh lu·∫≠n</label>
                <textarea id="reviewComment" rows="4"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#000f8f] focus:border-transparent transition-all"
                  placeholder="H√£y chia s·∫ª chi ti·∫øt v·ªÅ tr·∫£i nghi·ªám c·ªßa b·∫°n..."></textarea>
              </div>

              <!-- Image Upload Section -->
              <div class="space-y-2">
                <label class="block text-gray-700 font-medium">·∫¢nh ƒë√≠nh k√®m <span class="text-sm text-gray-500">(t·ªëi ƒëa
                    5 ·∫£nh)</span></label>
                <div class="flex items-center justify-center w-full">
                  <label for="imageUpload"
                    class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                      <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                      <p class="text-sm text-gray-500">Nh·∫•n ƒë·ªÉ t·∫£i ·∫£nh l√™n</p>
                    </div>
                    <input type="file" id="imageUpload" multiple accept="image/*" class="hidden">
                  </label>
                </div>
                <div id="previewImages" class="flex flex-wrap gap-2 mt-2"></div>
              </div>
            </div>

            <!-- Modal Footer -->
            <div class="bg-gray-50 px-6 py-4 flex justify-end space-x-3">
              <button id="cancelReview"
                class="px-5 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-gray-200 transition-colors">
                H·ªßy b·ªè
              </button>
              <button id="submitReview"
                class="px-5 py-2.5 text-white bg-[#000f8f] rounded-lg hover:bg-[#000e7a] focus:ring-2 focus:ring-blue-300 shadow-md transition-all">
                G·ª≠i ƒë√°nh gi√°
              </button>
            </div>
          </div>
        </div>


        <!-- Ph·∫ßn 4/10 -->
        <div class="w-4/10 flex-4 basis-2/5 bg-white rounded-lg p-6 mb-6 shadow-[0_0_15px_rgba(0,0,0,0.1)]">
          <!-- Ti√™u ƒë·ªÅ -->
          <div class="bg-[#000f8f] text-white px-4 py-2 rounded-md flex items-center space-x-2 mb-2"
            style="margin-top: -7px">
            <i class="fa-solid fa-gear"></i>
            <h3 class="font-semibold text-base">Th√¥ng s·ªë k·ªπ thu·∫≠t</h3>
          </div>

          <!-- Danh s√°ch th√¥ng s·ªë -->
          <div class="space-y-2 text-sm relative" style="position: relative">
            <div th:each="spec, iterStat : ${specifications}" th:if="${iterStat.index < 8}"
              th:class="${iterStat.index % 2 == 0} ? 'flex bg-white' : 'flex bg-gray-200'">
              <div class="w-1/2 px-4 py-2 font-medium" th:text="${#strings.replace(spec.specKey, '''', '')}"></div>
              <div class="w-1/2 px-4 py-2" th:utext="${#strings.replace(spec.specValue, '\n', '<br/>')}"></div>
            </div>

            <!-- üëá L·ªõp l√†m m·ªù ph·ªß l√™n d√≤ng cu·ªëi -->
            <div
              class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-white to-transparent pointer-events-none rounded-b-lg">
            </div>
          </div>

          <!-- N√∫t xem t·∫•t c·∫£ -->
          <div class="text-center mt-4">
            <button onclick="toggleFullSpecs()"
              class="px-6 py-2 border border-[#000f8f] text-[#000f8f] rounded hover:bg-[#000f8f] hover:text-white transition">
              Xem t·∫•t c·∫£
            </button>
          </div>

          <!-- Overlay + Popup form -->
          <div id="full-specs-modal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl p-6 relative">
              <!-- N√∫t ƒë√≥ng -->
              <button onclick="toggleFullSpecs()"
                class="absolute top-2 right-2 text-gray-500 hover:text-red-600 text-2xl">
                &times;
              </button>

              <!-- Ti√™u ƒë·ªÅ -->
              <div class="flex items-center bg-blue-900 text-white font-semibold px-4 py-2 rounded-t">
                <i class="ri-settings-3-fill mr-2"></i>
                Th√¥ng s·ªë k·ªπ thu·∫≠t ƒë·∫ßy ƒë·ªß
              </div>

              <!-- N·ªôi dung th√¥ng s·ªë -->
              <div class="divide-y divide-gray-200">
                <div th:each="spec, iterStat : ${specifications}"
                  th:class="${iterStat.index % 2 == 0} ? 'flex bg-white' : 'flex bg-gray-100'">
                  <div class="w-1/2 px-4 py-2 font-medium" th:text="${#strings.replace(spec.specKey, '''', '')}"></div>
                  <div class="w-1/2 px-4 py-2" th:utext="${#strings.replace(spec.specValue, '\n', '<br/>')}"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ƒêo·∫°n 3 -->
      <div class="bg-white rounded-lg p-6 mb-6 shadow-[0_0_15px_rgba(0,0,0,0.1)]"
        style="max-width: 1250px; margin: auto">
        <div class="flex items-center justify-between mb-8" style="margin-bottom: 5px">
          <h2 class="text-2xl font-bold border-l-8 border-custom-blue pl-4">
            C√ÅC S·∫¢N PH·∫®M LI√äN QUAN
          </h2>
        </div>

        <!-- S·∫£n ph·∫©m kh√°c c√≥ th·ªÉ b·∫°n quan t√¢m: -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">

          <div th:each="product : ${products}"
            class="bg-white rounded-lg border border-gray-200 shadow-lg hover:shadow-lg transition-all duration-300 group relative overflow-hidden">

            <!-- M√°c gi·∫£m gi√° -->
            <div class="absolute top-3 left-3 z-10" th:if="${product.discountedPrice < product.price}">
              <div class="relative">
                <div class="bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-sm 
                                                transform -rotate-3 origin-left
                                                shadow-[2px_2px_0px_rgba(0,0,0,0.2)] 
                                                group-hover:shadow-[3px_3px_0px_rgba(0,0,0,0.3)]
                                                transition-all duration-200">
                  GI·∫¢M <span th:text="${product.discount}">0</span>%
                </div>
                <!-- Hi·ªáu ·ª©ng g√≥c g·∫≠p 3D */ -->
                <div class="absolute top-full left-1 w-4 h-1 bg-red-700 
                                                transform -rotate-6 origin-top-left
                                                opacity-80"></div>
              </div>
            </div>

            <!-- H√¨nh ·∫£nh s·∫£n ph·∫©m -->
            <div class="relative">
              <a th:href="@{/detail/} + ${product.variantID}" class="flex items-center justify-center bg-transparent">
                <img th:if="${product.imagesno2 != null}" th:src="@{'/images/' + ${product.imagesno2}}"
                  alt="Product image"
                  class="w-[200px] mt-7 h-[200px] object-center object-contain transition-transform duration-300 group-hover:scale-110" />
                <img th:unless="${product.imagesno2 != null}" src="https://via.placeholder.com/300x200?text=No+Image"
                  alt="Placeholder image"
                  class="w-[130px] h-auto object-center object-contain transition-transform duration-300 group-hover:scale-110" />
              </a>

              <!-- Wishlist -->
              <div th:action="@{/add}" method="post" class="absolute top-2 right-2 w-8 h-8 flex items-center justify-center rounded-full bg-white shadow-md 
             opacity-0 group-hover:opacity-100 transition-all duration-300">
                <button type="button" class="wishlist-toggle w-8 h-8 flex items-center justify-center rounded-full bg-white shadow-md
         opacity-0 group-hover:opacity-100 transition-all duration-300" th:attr="data-variant-id=${product.variantID}">
                  <i th:class="${wishlistIds != null and wishlistIds.contains(product.variantID)} ?
                'ri-heart-fill text-red-600' : 'ri-heart-line text-gray-600 hover:text-red-500'"></i>
                </button>
              </div>

              <!-- N√∫t gi·ªè h√†ng -->
              <button
                class="absolute right-2 bottom-2 w-10 h-10 flex items-center justify-center bg-[#000f8f] text-white rounded-full transform translate-x-full opacity-0 group-hover:translate-x-0 group-hover:opacity-100 transition-all duration-500 ease-in-out hover:bg-red-700 hover:scale-110 z-10"
                th:attr="data-variant-id=${product.variantID}" onclick="addToCart(this)">
                <i class="ri-shopping-cart-line"></i>
              </button>
            </div>

            <!-- N·ªôi dung -->
            <div class="p-4">
              <a th:href="@{/detail/} + ${product.variantID}" class="block">
                <h3
                  class=" h-[70px] font-medium text-gray-800 mb-1 hover:text-yellow-400 transition-colors duration-300"
                  th:text="${product.product.productName} + ' ' + ${product.storage} + ' - Ch√≠nh h√£ng VN'">
                </h3>

              </a>

              <div class="flex items-center mb-2">
                <div class="flex text-yellow-400" style="font-size: 18px;">
                  <i class="ri-star-fill ri-xs"></i>
                  <i class="ri-star-fill ri-xs"></i>
                  <i class="ri-star-fill ri-xs"></i>
                  <i class="ri-star-fill ri-xs"></i>
                  <i class="ri-star-fill ri-xs"></i>
                </div>
              </div>

              <div class="flex items-center justify-between">
                <div>
                  <!-- N·∫øu c√≥ gi·∫£m -->
                  <span
                    th:if="${product.discountedPrice != null and product.price != null and product.discountedPrice < product.price}"
                    class="flex items-center gap-2">

                    <span class="text-lg font-bold text-red-600"
                      th:text="${#numbers.formatDecimal(product.discountedPrice, 0, 'COMMA', 0, 'POINT') + '‚Ç´'}"></span>

                    <span class=" text-gray-500 line-through"
                      style="font-size: 14px; margin-left: 110px; position: absolute;"
                      th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') + '‚Ç´'}"></span>
                  </span>


                  <!-- N·∫øu kh√¥ng gi·∫£m -->
                  <span th:if="${product.discountedPrice == null or product.discountedPrice >= product.price}">
                    <span class="text-lg font-bold text-red-600"
                      th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') + '‚Ç´'}"></span>
                  </span>

                </div>

                <!-- Fallback cho mobile -->
                <button
                  class="w-10 h-10 md:hidden flex items-center justify-center bg-primary text-white rounded-full hover:bg-red-700 transition-all duration-300 transform hover:scale-110">
                  <i class="ri-shopping-cart-line"></i>
                </button>
              </div>

            </div>

            <!-- Overlay hover -->
            <div
              class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-5 transition-all duration-300 pointer-events-none">
            </div>
          </div>

          <!-- N·∫øu kh√¥ng c√≥ s·∫£n ph·∫©m -->
          <div th:if="${#lists.isEmpty(products)}" class="w-full text-center py-12 " style="margin-left: 500px;">
            <img
              src="https://i.postimg.cc/nrf4Qjsw/pngtree-business-web-error-404-concept-illustration-png-image-3507632-removebg-preview.png"
              alt="No products" class="mx-auto w-[250px] h-auto   " style="margin-top: -50px;" />
            <p class="text-gray-800 text-lg">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o ƒë∆∞·ª£c t√¨m th·∫•y.</p>
          </div>


        </div>

        <!-- N√∫t "Xem t·∫•t c·∫£" s·∫Ω d·∫´n ƒë·∫øn trang danh s√°ch s·∫£n ph·∫©m kh√°c -->
        <button class="xem-tat-ca-btn" style="margin-top: 20px">
          <a href="/products">Xem to√†n b·ªô s·∫£n ph·∫©m</a>
          <i class="arrow-icon fas fa-arrow-right"></i>
        </button>
      </div>


    </div>
  </section>

  <!-- Footer -->
  <div th:insert="views/shared/footer :: footerFragment" style="margin-top: 30px"></div>
</body>

</html>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // L·∫•y c√°c ph·∫ßn t·ª≠ c·∫ßn thi·∫øt
    const mainImage = document.getElementById("main-image");
    const thumbnails = document.querySelectorAll(".thumbnail");
    const colorOptions = document.querySelectorAll('input[name="mausac"]');
    const storageOptions = document.querySelectorAll(".storage-link label");

    // H√†m c·∫≠p nh·∫≠t ·∫£nh ch√≠nh v√† active thumbnail
    function updateMainImage(imageUrl, altText) {
      // Th√™m hi·ªáu ·ª©ng fade khi thay ƒë·ªïi ·∫£nh
      mainImage.style.opacity = "0";
      setTimeout(() => {
        mainImage.src = imageUrl;
        mainImage.alt = altText;
        mainImage.style.opacity = "1";
      }, 300);
    }

    // H√†m c·∫≠p nh·∫≠t tr·∫°ng th√°i active cho c√°c ph·∫ßn t·ª≠
    function updateActiveStates(activeElement, elements, activeClass) {
      elements.forEach((element) => {
        if (element === activeElement) {
          element.classList.add(...activeClass.split(" "));
        } else {
          element.classList.remove(...activeClass.split(" "));
        }
      });
    }

    // X·ª≠ l√Ω khi click v√†o thumbnail
    thumbnails.forEach((thumbnail, index) => {
      thumbnail.addEventListener("click", function (e) {
        e.preventDefault();
        const imgElement = this.querySelector("img");
        updateMainImage(imgElement.src, imgElement.alt);

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i active cho thumbnail
        updateActiveStates(
          this,
          thumbnails,
          "border-blue-500 ring-2 ring-blue-300"
        );

        // C·∫≠p nh·∫≠t radio button t∆∞∆°ng ·ª©ng
        const colorValue = imgElement.alt;
        const correspondingRadio = Array.from(colorOptions).find(
          (radio) => radio.value === colorValue
        );

        if (correspondingRadio) {
          correspondingRadio.checked = true;
          // C·∫≠p nh·∫≠t UI cho m√†u s·∫Øc
          const colorContainer = correspondingRadio
            .closest("label")
            .querySelector("div");
          updateActiveStates(
            colorContainer,
            Array.from(colorOptions).map((opt) =>
              opt.closest("label").querySelector("div")
            ),
            "border-blue-500 bg-blue-50 ring-2 ring-blue-300"
          );

          // Chuy·ªÉn trang
          const variantId = correspondingRadio.getAttribute("data-variant-id");
          if (variantId) {
            window.location.href = "/detail/" + variantId;
          }
        }
      });
    });

    // X·ª≠ l√Ω khi ch·ªçn m√†u s·∫Øc
    colorOptions.forEach((radio) => {
      radio.addEventListener("change", function () {
        if (this.checked) {
          // C·∫≠p nh·∫≠t UI cho m√†u s·∫Øc
          const colorContainer = this.closest("label").querySelector("div");
          updateActiveStates(
            colorContainer,
            Array.from(colorOptions).map((opt) =>
              opt.closest("label").querySelector("div")
            ),
            "border-blue-500 bg-blue-50 ring-2 ring-blue-300"
          );

          // C·∫≠p nh·∫≠t ·∫£nh ch√≠nh t·ª´ thumbnail t∆∞∆°ng ·ª©ng
          const colorValue = this.value;
          const correspondingThumbnail = Array.from(thumbnails).find(
            (thumb) => {
              return thumb.querySelector("img").alt === colorValue;
            }
          );

          if (correspondingThumbnail) {
            const imgElement = correspondingThumbnail.querySelector("img");
            updateMainImage(imgElement.src, imgElement.alt);
            updateActiveStates(
              correspondingThumbnail,
              thumbnails,
              "border-blue-500 ring-2 ring-blue-300"
            );
          }

          // Chuy·ªÉn trang
          const variantId = this.getAttribute("data-variant-id");
          if (variantId) {
            window.location.href = "/detail/" + variantId;
          }
        }
      });
    });

    // Kh·ªüi t·∫°o tr·∫°ng th√°i ban ƒë·∫ßu
    function initializeActiveStates() {
      // T√¨m m√†u s·∫Øc ƒëang ƒë∆∞·ª£c ch·ªçn
      const activeRadio = Array.from(colorOptions).find(
        (radio) => radio.checked
      );
      if (activeRadio) {
        const colorContainer = activeRadio
          .closest("label")
          .querySelector("div");
        colorContainer.classList.add(
          "border-blue-500",
          "bg-blue-50",
          "ring-2",
          "ring-blue-300"
        );

        // T√¨m thumbnail t∆∞∆°ng ·ª©ng
        const colorValue = activeRadio.value;
        const activeThumbnail = Array.from(thumbnails).find((thumb) => {
          return thumb.querySelector("img").alt === colorValue;
        });

        if (activeThumbnail) {
          activeThumbnail.classList.add(
            "border-blue-500",
            "ring-2",
            "ring-blue-300"
          );
        }
      }

      // Storage options ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω b·∫±ng Thymeleaf
    }
    initializeActiveStates();

    // X·ª≠ l√Ω tƒÉng gi·∫£m s·ªë l∆∞·ª£ng s·∫£n ph·∫©m
    // const minusBtn = document.querySelector(".quantity-btn.minus");
    // const plusBtn = document.querySelector(".quantity-btn.plus");
    // const quantityInput = document.querySelector(".quantity-input");

    // if (minusBtn && plusBtn && quantityInput) {
    //   minusBtn.addEventListener("click", function () {
    //     let value = parseInt(quantityInput.value);
    //     if (value > 1) {
    //       quantityInput.value = value - 1;
    //     }
    //   });

    //   plusBtn.addEventListener("click", function () {
    //     let value = parseInt(quantityInput.value);
    //     if (value < 99) {
    //       quantityInput.value = value + 1;
    //     }
    //   });

    //   quantityInput.addEventListener("change", function () {
    //     let value = parseInt(this.value);
    //     if (isNaN(value) || value < 1) {
    //       this.value = 1;
    //     } else if (value > 99) {
    //       this.value = 99;
    //     }
    //   });
    // }

    // Hi·ªáu ·ª©ng cu·ªôn cho ph·∫ßn h√¨nh ·∫£nh s·∫£n ph·∫©m
    const scrollableSection = document.querySelector(
      ".product-images-scrollable"
    );
    if (scrollableSection) {
      const scrollLimit = 450;

      window.addEventListener("scroll", function () {
        if (window.innerWidth >= 1024) {
          const scrollPosition = window.scrollY || window.pageYOffset;
          const translateY = Math.min(scrollPosition, scrollLimit);
          scrollableSection.style.transform = `translateY(${translateY}px)`;

          if (scrollPosition >= scrollLimit) {
            document.body.classList.add("scrolled");
          } else {
            document.body.classList.remove("scrolled");
          }
        }
      });
    }

    // X·ª≠ l√Ω s·ª± ki·ªán click cho c√°c n√∫t b·ªô l·ªçc
    const buttons = document.querySelectorAll(".filter-button");
    buttons.forEach((button) => {
      button.addEventListener("click", () => {
        buttons.forEach((btn) =>
          btn.classList.remove("border-blue-600", "font-semibold")
        );
        button.classList.add("border-blue-600", "font-semibold");
      });
    });
  });

  // H√†m hi·ªÉn th·ªã th√¥ng s·ªë k·ªπ thu·∫≠t ƒë·∫ßy ƒë·ªß
  function toggleFullSpecs() {
    const modal = document.getElementById("full-specs-modal");
    if (modal) {
      modal.classList.toggle("hidden");
    }
  }
</script>
<script> // Hi·ªáu ·ª©ng cu·ªôn cho ph·∫ßn h√¨nh ·∫£nh s·∫£n ph·∫©m
  document.addEventListener('DOMContentLoaded', function () {
    const scrollableSection = document.querySelector('.product-images-scrollable');
    const scrollLimit = 400; // Gi·ªõi h·∫°n 200px

    window.addEventListener('scroll', function () {
      if (window.innerWidth >= 1024) {
        const scrollPosition = window.scrollY || window.pageYOffset;
        const translateY = Math.min(scrollPosition, scrollLimit);

        scrollableSection.style.transform = `translateY(${translateY}px)`;

        // Th√™m class khi ƒë·∫°t gi·ªõi h·∫°n
        if (scrollPosition >= scrollLimit) {
          document.body.classList.add('scrolled');
        } else {
          document.body.classList.remove('scrolled');
        }
      }
    });
  });
</script>
<script> // X·ª≠ l√Ω s·ª± ki·ªán click cho n√∫t wishlist
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.wishlist-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const variantId = this.getAttribute('data-variant-id');
        const userId = this.getAttribute('data-user-id');

        if (!userId) {
          window.location.href = '/login?redirect=' + encodeURIComponent(window.location.pathname);
          return;
        }

        fetch(`/api/wishlist/toggle?userId=${userId}&productVariantId=${variantId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const icon = this.querySelector('i');
              if (data.added) {
                icon.classList.replace('ri-heart-line', 'ri-heart-fill');
                icon.classList.replace('text-gray-600', 'text-red-500');
                this.classList.add('active');
              } else {
                icon.classList.replace('ri-heart-fill', 'ri-heart-line');
                icon.classList.replace('text-red-500', 'text-gray-600');
                this.classList.remove('active');
              }
            }
          })
          .catch(error => console.error('Error:', error));
      });
    });
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const qtyInput = document.getElementById("quantity");
    const decreaseBtn = document.getElementById("decreaseQty");
    const increaseBtn = document.getElementById("increaseQty");

    decreaseBtn.addEventListener("click", () => {
      let qty = parseInt(qtyInput.value);
      if (qty > 1) qtyInput.value = qty - 1;
    });

    increaseBtn.addEventListener("click", () => {
      let qty = parseInt(qtyInput.value);
      if (qty < 99) qtyInput.value = qty + 1;
    });

    qtyInput.addEventListener("change", function () {
      let value = parseInt(this.value);
      if (isNaN(value) || value < 1) {
        this.value = 1;
      } else if (value > 99) {
        this.value = 99;
      }
    });
  });
</script>

<script> // X·ª≠ l√Ω ƒë√°nh gi√° s·∫£n ph·∫©m
  document.addEventListener('DOMContentLoaded', function () {
    const productId = 1; // Replace with actual product ID
    let currentUser = null;
    let currentFilter = 0; // 0 means all reviews

    // Check login status
    async function checkLoginStatus() {
      try {
        const response = await fetch('/api/reviews/check-auth', {
          credentials: 'include'
        });

        if (response.ok) {
          const data = await response.json();
          currentUser = data.username;
          return true;
        }
        throw new Error('Not logged in');
      } catch (error) {
        currentUser = null;
        return false;
      }
    }

    // Initialize the page
    async function initialize() {
      await checkLoginStatus();
      loadReviews(productId, currentFilter);
      updateReviewStats(productId);
    }

    // Open review modal
    document.getElementById('openReviewModal').addEventListener('click', async function () {
      const isLoggedIn = await checkLoginStatus();
      if (!isLoggedIn) {
        Swal.fire({
          icon: 'warning',
          title: 'Th√¥ng b√°o',
          text: 'Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒë√°nh gi√° s·∫£n ph·∫©m',
          confirmButtonText: 'OK'
        });
        return;
      }

      document.getElementById('reviewModal').classList.remove('hidden');
    });

    // Close review modal
    document.getElementById('cancelReview').addEventListener('click', function () {
      document.getElementById('reviewModal').classList.add('hidden');
      document.getElementById('previewImages').innerHTML = '';
      document.getElementById('reviewComment').value = '';
      document.getElementById('ratingValue').value = 0;

      // Reset stars
      const stars = document.querySelectorAll('.rating-stars i');
      stars.forEach(star => {
        star.classList.remove('fa-solid', 'text-yellow-500');
        star.classList.add('fa-regular');
      });
    });

    // Star rating selection
    const stars = document.querySelectorAll('.rating-stars i');
    stars.forEach(star => {
      star.addEventListener('click', function () {
        const value = parseInt(this.getAttribute('data-value'));
        document.getElementById('ratingValue').value = value;

        stars.forEach((s, index) => {
          if (index < value) {
            s.classList.remove('fa-regular');
            s.classList.add('fa-solid', 'text-yellow-500');
          } else {
            s.classList.remove('fa-solid', 'text-yellow-500');
            s.classList.add('fa-regular');
          }
        });
      });
    });

    // Image preview
    document.getElementById('imageUpload').addEventListener('change', function (e) {
      const previewContainer = document.getElementById('previewImages');
      previewContainer.innerHTML = '';

      Array.from(e.target.files).slice(0, 5).forEach(file => {
        if (!file.type.match('image.*')) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.className = 'h-20 object-cover mr-2 mb-2 rounded';
          previewContainer.appendChild(img);
        }
        reader.readAsDataURL(file);
      });
    });

    // Submit review
    document.getElementById('submitReview').addEventListener('click', async function () {
      const isLoggedIn = await checkLoginStatus();
      if (!isLoggedIn) {
        Swal.fire({
          icon: 'info',
          title: 'Th√¥ng b√°o',
          text: 'Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n, vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i',
          confirmButtonText: 'OK'
        });
        return;
      }


      const rating = document.getElementById('ratingValue').value;
      const comment = document.getElementById('reviewComment').value;
      const imageFiles = document.getElementById('imageUpload').files;

      if (rating === '0') {
        Swal.fire({
          icon: 'warning',
          title: 'Ch∆∞a ch·ªçn ƒë√°nh gi√°',
          text: 'Vui l√≤ng ch·ªçn s·ªë sao ƒë√°nh gi√° tr∆∞·ªõc khi g·ª≠i',
          confirmButtonText: 'OK'
        });
        return;
      }


      if (!comment.trim()) {
        Swal.fire({
          icon: 'warning',
          title: 'Thi·∫øu n·ªôi dung',
          text: 'Vui l√≤ng nh·∫≠p b√¨nh lu·∫≠n',
          confirmButtonText: 'OK'
        });
        return;
      }


      const formData = new FormData();
      formData.append('productId', productId);
      formData.append('rating', rating);
      formData.append('comment', comment);

      if (imageFiles.length > 0) {
        Array.from(imageFiles).slice(0, 5).forEach(file => {
          formData.append('images', file);
        });
      }

      try {
        const response = await fetch('/api/reviews', {
          method: 'POST',
          body: formData,
          credentials: 'include'
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Error submitting review');
        }

        Swal.fire({
          icon: 'success',
          title: 'Th√†nh c√¥ng',
          text: 'ƒê√°nh gi√° c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i!',
          confirmButtonText: 'OK'
        });

        document.getElementById('reviewModal').classList.add('hidden');
        document.getElementById('reviewComment').value = '';
        document.getElementById('imageUpload').value = '';
        document.getElementById('previewImages').innerHTML = '';

        // Reset stars
        stars.forEach(star => {
          star.classList.remove('fa-solid', 'text-yellow-500');
          star.classList.add('fa-regular');
        });

        loadReviews(productId, currentFilter);
        updateReviewStats(productId);
      } catch (error) {
        console.error('Error:', error);
        alert('C√≥ l·ªói x·∫£y ra khi g·ª≠i ƒë√°nh gi√°: ' + error.message);
      }
    });

    // Filter reviews by rating
    document.querySelectorAll('.filter-button').forEach(button => {
      button.addEventListener('click', function () {
        const rating = parseInt(this.getAttribute('data-rating'));
        currentFilter = rating;

        // Update active filter button
        document.querySelectorAll('.filter-button').forEach(btn => {
          btn.classList.remove('bg-gray-200', 'border-gray-500', 'active-filter');
        });
        this.classList.add('bg-gray-200', 'border-gray-500', 'active-filter');

        loadReviews(productId, rating);
      });
    });

    // Load reviews with optional rating filter
    async function loadReviews(productId, rating = null) {
      try {
        let url = `/api/reviews/product/${productId}`;
        if (rating && rating >= 1 && rating <= 5) {
          url += `?rating=${rating}`;
        }

        const response = await fetch(url);
        if (!response.ok) throw new Error('Failed to load reviews');

        const reviews = await response.json();
        const reviewsContainer = document.getElementById('reviews-container');
        reviewsContainer.innerHTML = '';

        if (reviews.length === 0) {
          reviewsContainer.innerHTML = `
                <div class="text-center py-4 text-gray-800" style="margin-bottom: 70px; margin-top: 120px">
                    ${rating ? `Ch∆∞a c√≥ ƒë√°nh gi√° ${rating} sao n√†o` : 'Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho s·∫£n ph·∫©m n√†y'}
                </div>
            `;
          return;
        }

        for (const review of reviews) {
          const reviewElement = await createReviewElement(review);
          reviewsContainer.appendChild(reviewElement);
        }
      } catch (error) {
        console.error('Error loading reviews:', error);
        document.getElementById('reviews-container').innerHTML = `
            <div class="text-center py-4 text-red-500">
                ƒê√£ x·∫£y ra l·ªói khi t·∫£i ƒë√°nh gi√°
            </div>
        `;
      }
    }

    // Create a single review element
    async function createReviewElement(review) {
      const reviewElement = document.createElement('div');
      reviewElement.className = 'border-t border-gray-400 pt-4';
      reviewElement.dataset.reviewId = review.id;


      // Format date
      const date = review.createdAt ?
        new Date(review.createdAt).toLocaleString('vi-VN', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }) : 'Kh√¥ng r√µ ng√†y';


      // Create star rating
      const starsHtml = Array(5).fill().map((_, i) =>
        `<i class="fa-solid ${i < review.rating ? 'text-yellow-500' : 'text-gray-300'} fa-star"></i>`
      ).join('');

      // Handle images
      let imagesHtml = '';
      if (review.images) {
        const imageUrls = review.images.split(',');
        imagesHtml = `<div class="flex flex-wrap mt-2">${imageUrls.map(url =>
          `<img src="${url}" class="h-20 object-cover mr-2 mb-2 rounded cursor-pointer" 
                     onclick="window.open('${url}', '_blank')">`
        ).join('')
          }</div>`;
      }

      // Check if user has liked this review
      let hasLiked = false;
      if (currentUser) {
        try {
          const response = await fetch(`/api/reviews/${review.id}/has-liked`, {
            credentials: 'include'
          });
          if (response.ok) {
            const data = await response.json();
            hasLiked = data.hasLiked;
          }
        } catch (error) {
          console.error('Error checking like status:', error);
        }
      }

      // Get like count
      let likeCount = 0;
      try {
        const response = await fetch(`/api/reviews/${review.id}/like-count`);
        if (response.ok) {
          const data = await response.json();
          likeCount = data.count;
        }
      } catch (error) {
        console.error('Error getting like count:', error);
      }

      reviewElement.innerHTML = `
            <div class="flex justify-between items-start">
                <p class="font-semibold">${review.username || '·∫®n danh'}</p>
                <span class="text-sm text-gray-500">${date}</span>
            </div>
            <div class="flex items-center mb-1">
                <div class="text-yellow-500 mr-2">
                    ${starsHtml}
                </div>
            </div>
            <p class="text-gray-800 mb-2">${review.comment || ''}</p>
            ${imagesHtml}
            
            <div class="flex items-center justify-between mt-3">
                <div class="flex gap-4 text-xs text-gray-500">
                    <a href="#" class="hover:underline reply-link">Tr·∫£ l·ªùi</a>
                    <button class="like-button hover:underline flex items-center gap-1 ${hasLiked ? 'text-blue-500' : ''}" 
                            data-review-id="${review.id}">
                        <i class="fa-${hasLiked ? 'solid' : 'regular'} fa-thumbs-up"></i>
                        <span class="like-count">${likeCount}</span>
                    </button>
                </div>
            </div>
            
            <!-- Reply form (hidden by default) -->
            <div class="reply-modal hidden mt-3 pl-4 border-l-2 border-gray-200">
                <textarea class="w-full px-3 py-2 border rounded-md reply-input" 
                         rows="2" placeholder="Vi·∫øt ph·∫£n h·ªìi c·ªßa b·∫°n..."></textarea>
                <div class="flex justify-end gap-2 mt-2">
                    <button class="px-3 py-1 bg-gray-200 rounded-md cancel-reply">H·ªßy</button>
                    <button class="px-3 py-1 bg-blue-500 text-white rounded-md submit-reply">G·ª≠i</button>
                </div>
            </div>
            
            <!-- Feedback list -->
            <div class="feedback-list mt-3 pl-4 border-l-2 border-gray-200"></div>
        `;

      // Load feedback for this review
      const feedbackList = reviewElement.querySelector('.feedback-list');
      loadFeedback(review.id, feedbackList);

      // Set up event handlers for this review
      setupReviewEventHandlers(reviewElement);

      return reviewElement;
    }

    // Set up event handlers for a review element
    function setupReviewEventHandlers(reviewElement) {
      // Reply link
      const replyLink = reviewElement.querySelector('.reply-link');
      if (replyLink) {
        replyLink.addEventListener('click', async function (e) {
          e.preventDefault();

          const isLoggedIn = await checkLoginStatus();
          if (!isLoggedIn) {
            Swal.fire({
              icon: 'info',
              title: 'Th√¥ng b√°o',
              text: 'Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i ph·∫£n h·ªìi',
              confirmButtonText: 'OK'
            });
            return;
          }


          const replyModal = reviewElement.querySelector('.reply-modal');
          if (replyModal) {
            // Hide all other reply modals
            document.querySelectorAll('.reply-modal').forEach(modal => {
              if (modal !== replyModal) modal.classList.add('hidden');
            });

            replyModal.classList.toggle('hidden');
            if (!replyModal.classList.contains('hidden')) {
              replyModal.querySelector('.reply-input').focus();
            }
          }
        });
      }

      // Cancel reply
      const cancelReply = reviewElement.querySelector('.cancel-reply');
      if (cancelReply) {
        cancelReply.addEventListener('click', function () {
          const replyModal = this.closest('.reply-modal');
          if (replyModal) {
            replyModal.classList.add('hidden');
            replyModal.querySelector('.reply-input').value = '';
          }
        });
      }

      // Submit reply
      const submitReply = reviewElement.querySelector('.submit-reply');
      if (submitReply) {
        submitReply.addEventListener('click', async function () {
          const isLoggedIn = await checkLoginStatus();
          if (!isLoggedIn) {
            alert('Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n, vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i');
            return;
          }

          const replyModal = this.closest('.reply-modal');
          if (!replyModal) return;

          const reviewId = reviewElement.dataset.reviewId;
          const content = replyModal.querySelector('.reply-input').value.trim();

          if (!content) {
            alert('Vui l√≤ng nh·∫≠p n·ªôi dung ph·∫£n h·ªìi');
            return;
          }

          try {
            const response = await fetch(`/api/reviews/${reviewId}/feedback`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: `content=${encodeURIComponent(content)}`,
              credentials: 'include'
            });

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.error || 'Error submitting feedback');
            }

            replyModal.querySelector('.reply-input').value = '';
            replyModal.classList.add('hidden');

            // Reload feedback
            const feedbackList = reviewElement.querySelector('.feedback-list');
            if (feedbackList) {
              loadFeedback(reviewId, feedbackList);
            }
          } catch (error) {
            console.error('Error submitting feedback:', error);
            alert('C√≥ l·ªói x·∫£y ra khi g·ª≠i ph·∫£n h·ªìi: ' + error.message);
          }
        });
      }

      // Like button
      const likeButton = reviewElement.querySelector('.like-button');
      if (likeButton) {
        likeButton.addEventListener('click', async function (e) {
          e.preventDefault();

          const isLoggedIn = await checkLoginStatus();
          if (!isLoggedIn) {
            alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√≠ch ƒë√°nh gi√°');
            return;
          }

          const reviewId = this.dataset.reviewId;
          try {
            const response = await fetch(`/api/reviews/${reviewId}/like`, {
              method: 'POST',
              credentials: 'include'
            });

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.error || 'Error liking review');
            }

            // Toggle like state
            const icon = this.querySelector('i');
            const likeCountElement = this.querySelector('.like-count');

            if (icon.classList.contains('fa-regular')) {
              // User just liked the review
              icon.classList.remove('fa-regular');
              icon.classList.add('fa-solid');
              this.classList.add('text-blue-500');
              likeCountElement.textContent = parseInt(likeCountElement.textContent) + 1;
            } else {
              // User unliked the review
              icon.classList.remove('fa-solid');
              icon.classList.add('fa-regular');
              this.classList.remove('text-blue-500');
              likeCountElement.textContent = parseInt(likeCountElement.textContent) - 1;
            }
          } catch (error) {
            console.error('Error liking review:', error);
            alert('C√≥ l·ªói x·∫£y ra khi th√≠ch ƒë√°nh gi√°: ' + error.message);
          }
        });
      }
    }

    // Load feedback for a review
    async function loadFeedback(reviewId, feedbackContainer) {
      try {
        const response = await fetch(`/api/reviews/${reviewId}/feedback`);
        if (!response.ok) throw new Error('Failed to load feedback');

        const feedbacks = await response.json();
        feedbackContainer.innerHTML = '';

        if (feedbacks.length === 0) return;

        feedbacks.forEach(feedback => {
          const feedbackElement = document.createElement('div');
          feedbackElement.className = 'mb-3 pb-2 border-b border-gray-100 last:border-0';



          const date = feedback.createdAt ?
            new Date(feedback.createdAt).toLocaleString('vi-VN', {
              day: '2-digit',
              month: '2-digit',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            }) : 'Kh√¥ng r√µ ng√†y';



          feedbackElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <p class="font-semibold text-sm">${feedback.username || '·∫®n danh'}</p>
                        <span class="text-xs text-gray-500">${date}</span>
                    </div>
                    <p class="text-gray-800 text-sm mt-1">${feedback.content || ''}</p>
                `;

          feedbackContainer.appendChild(feedbackElement);
        });
      } catch (error) {
        console.error('Error loading feedback:', error);
        feedbackContainer.innerHTML = `
                <p class="text-red-500 text-sm">ƒê√£ x·∫£y ra l·ªói khi t·∫£i ph·∫£n h·ªìi</p>
            `;
      }
    }

    // Update review statistics
    async function updateReviewStats(productId) {
      try {
        const response = await fetch(`/api/reviews/stats/${productId}`);
        if (!response.ok) throw new Error('Failed to load review stats');

        const stats = await response.json();

        // Update average rating
        document.getElementById('average-rating').textContent =
          `${stats.averageRating.toFixed(1)}/5`;

        // Update average stars
        const avgRating = Math.round(stats.averageRating);
        const starsContainer = document.getElementById('average-stars');
        starsContainer.innerHTML = '';

        for (let i = 1; i <= 5; i++) {
          const star = document.createElement('i');
          star.className = `fa-solid fa-star ${i <= avgRating ? 'text-yellow-500' : 'text-gray-300'}`;
          if (i === avgRating && stats.averageRating % 1 > 0.3) {
            star.className = 'fa-solid fa-star-half-stroke text-yellow-500';
          }
          starsContainer.appendChild(star);
        }

        // Update total reviews
        document.getElementById('total-reviews').textContent =
          `(${stats.totalReviews} ƒë√°nh gi√°)`;

        // Update filter buttons
        document.querySelectorAll('.filter-button').forEach((button, index) => {
          if (index < 5) {
            const rating = 5 - index;
            button.textContent = `${rating} sao (${stats.ratingCounts[rating + 'star']})`;
          } else if (index === 5) {
            button.textContent = `T·∫•t c·∫£ (${stats.totalReviews})`;
          }
        });
      } catch (error) {
        console.error('Error updating review stats:', error);
      }
    }

    // Initialize the page
    initialize();
  });
</script>